<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搜索助手</title>
    <!-- 精简资源加载：保留核心CDN，避免冗余 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script>
        // 简化Tailwind配置，只保留必要颜色
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9'
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .bg-gradient-ai {
                background: linear-gradient(135deg, #165DFF 0%, #36CFC9 100%);
            }
            .scrollbar-hide {
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .toast-animation {
                animation: toast 3s ease-in-out forwards;
            }
            @keyframes toast {
                0% { opacity: 0; transform: translateY(-20px); }
                20% { opacity: 1; transform: translateY(0); }
                80% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-20px); }
            }
        }
    </style>
    
    <!-- 合并动画样式，减少DOM操作 -->
    <style>
        @keyframes fadeIn {from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .animate-fade-in{animation:fadeIn 0.3s ease-out forwards}
        @keyframes pulse {0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
        .animate-pulse{animation:pulse 1.5s infinite}
        @keyframes float {0%{transform:translateY(0)}50%{transform:translateY(-8px)}100%{transform:translateY(0)}}
        .animate-float{animation:float 3s ease-in-out infinite}
    </style>
</head>
<body class="bg-[#F5F7FA] min-h-screen flex flex-col overflow-hidden">
    <!-- 开始界面 -->
    <div id="start-screen" class="fixed inset-0 bg-white flex flex-col items-center justify-center z-50">
        <div class="w-48 h-48 rounded-full bg-gradient-ai p-2 shadow-lg mb-8 animate-float">
            <img 
                src="https://pic.pngsucai.com/00/84/32/b476d75b65aee365.webp" 
                alt="八妹AI形象" 
                class="w-full h-full object-cover rounded-full"
                loading="lazy" <!-- 延迟加载图片，提升安卓打开速度 -->
            >
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">智能搜索工具</h1>
        <p class="text-gray-600 mb-8 text-center max-w-xs px-4">支持搜索、答疑、写作等任务</p>
        <button id="enter-button" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-full transition-all hover:scale-105 shadow-lg">
            开始使用
        </button>
    </div>

    <!-- 提示信息容器 -->
    <div id="toast-container" class="fixed top-4 left-1/2 -translate-x-1/2 z-40 pointer-events-none"></div>
    
    <!-- 关闭网页弹窗 -->
    <div id="close-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-6 max-w-xs w-full text-center shadow-xl">
            <h3 class="text-lg font-bold text-gray-800 mb-4">操作提示</h3>
            <p class="text-gray-600 mb-6">或许《喜剧之王》是个不错的选择</p>
            <button id="close-page-btn" class="bg-primary text-white px-6 py-2.5 rounded-full text-sm hover:bg-primary/90 transition-colors font-medium">
                返回上一页
            </button>
        </div>
    </div>
    
    <!-- 主要区域 -->
    <main class="flex-1 flex flex-col max-w-md w-full mx-auto p-4 opacity-0 transition-opacity duration-500">
        <!-- 上方：AI形象展示和欢迎语 -->
        <div class="flex-1 flex flex-col items-center justify-center text-center py-8">
            <div class="w-40 h-40 rounded-full bg-gradient-ai p-2 shadow-lg mb-6 animate-float">
                <img 
                    src="https://pic.pngsucai.com/00/84/32/b476d75b65aee365.webp" 
                    alt="八妹AI形象" 
                    class="w-full h-full object-cover rounded-full"
                    loading="lazy"
                >
            </div>
            <div class="space-y-3">
                <h1 class="text-2xl font-bold text-gray-800">智能搜索工具</h1>
                <p class="text-gray-600 text-base max-w-xs">支持搜索、答疑、写作等任务</p>
            </div>
        </div>
        
        <!-- 下方：可切换的输入框 -->
        <div class="bg-white rounded-2xl shadow-md p-4 mb-6">
            <div class="flex items-center space-x-2 mb-3">
                <button id="text-input-btn" class="flex-1 py-2 rounded-lg bg-[#F2F3F5] text-gray-600 flex items-center justify-center space-x-2 transition-all">
                    <i class="fa fa-keyboard-o"></i>
                    <span>文字</span>
                </button>
                <button id="voice-input-btn" class="flex-1 py-2 rounded-lg bg-primary text-white flex items-center justify-center space-x-2 transition-all">
                    <i class="fa fa-microphone"></i>
                    <span>语音</span>
                </button>
            </div>
            
            <!-- 文字输入区域 (默认隐藏) -->
            <div id="text-input-container" class="hidden flex items-center space-x-2">
                <textarea 
                    id="message-input" 
                    class="flex-1 border-0 outline-0 resize-none h-12 text-base placeholder-gray-400" 
                    placeholder="请输入您的问题..."
                ></textarea>
                <button id="send-btn" class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary/90 transition-colors">
                    <i class="fa fa-paper-plane"></i>
                </button>
            </div>
            
            <!-- 语音输入区域 (默认显示) -->
            <div id="voice-input-container" class="py-6 flex flex-col items-center justify-center">
                <div id="voice-button" class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-3 cursor-pointer hover:bg-primary/20 transition-all">
                    <i class="fa fa-microphone text-primary text-2xl"></i>
                </div>
                <p class="text-gray-600 text-sm">点击说话</p>
            </div>
        </div>
    </main>

    <!-- 语音输入状态提示 -->
    <div id="voice-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-6 max-w-xs w-full text-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 mx-auto mb-4 flex items-center justify-center animate-pulse">
                <i class="fa fa-microphone text-primary text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold mb-1">正在录音</h3>
            <p class="text-gray-500 text-sm mb-4">请说出您的问题</p>
            <button id="stop-voice-btn" class="bg-primary text-white px-5 py-2 rounded-full text-sm hover:bg-primary/90 transition-colors">
                完成录音
            </button>
        </div>
    </div>

    <script>
        // 提前获取所有DOM元素，减少重复查询（提升安卓性能）
        const startScreen = document.getElementById('start-screen');
        const enterButton = document.getElementById('enter-button');
        const mainContent = document.querySelector('main');
        const textInputBtn = document.getElementById('text-input-btn');
        const voiceInputBtn = document.getElementById('voice-input-btn');
        const textInputContainer = document.getElementById('text-input-container');
        const voiceInputContainer = document.getElementById('voice-input-container');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const voiceButton = document.getElementById('voice-button');
        const voiceModal = document.getElementById('voice-modal');
        const stopVoiceBtn = document.getElementById('stop-voice-btn');
        const toastContainer = document.getElementById('toast-container');
        const closeModal = document.getElementById('close-modal');
        const closePageBtn = document.getElementById('close-page-btn');
        
        let currentMode = 'voice'; // 输入模式：voice/text
        
        // 1. 开始使用按钮逻辑
        enterButton.addEventListener('click', () => {
            startScreen.style.transition = 'opacity 0.5s ease-out';
            startScreen.classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => {
                startScreen.style.display = 'none';
                mainContent.classList.remove('opacity-0');
            }, 500);
        });
        
        // 2. 输入模式切换
        textInputBtn.addEventListener('click', () => {
            if (currentMode !== 'text') {
                currentMode = 'text';
                textInputBtn.classList.replace('bg-[#F2F3F5]', 'bg-primary');
                textInputBtn.classList.replace('text-gray-600', 'text-white');
                voiceInputBtn.classList.replace('bg-primary', 'bg-[#F2F3F5]');
                voiceInputBtn.classList.replace('text-white', 'text-gray-600');
                textInputContainer.classList.remove('hidden');
                voiceInputContainer.classList.add('hidden');
            }
        });
        
        voiceInputBtn.addEventListener('click', () => {
            if (currentMode !== 'voice') {
                currentMode = 'voice';
                voiceInputBtn.classList.replace('bg-[#F2F3F5]', 'bg-primary');
                voiceInputBtn.classList.replace('text-gray-600', 'text-white');
                textInputBtn.classList.replace('bg-primary', 'bg-[#F2F3F5]');
                textInputBtn.classList.replace('text-white', 'text-gray-600');
                voiceInputContainer.classList.remove('hidden');
                textInputContainer.classList.add('hidden');
            }
        });
        
        // 3. 文本框高度自适应
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });
        
        // 4. 核心：提示显示后延迟2秒弹出关闭弹窗
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'bg-white px-4 py-2 rounded-lg shadow-lg text-gray-800 toast-animation';
            toast.textContent = message;
            toastContainer.appendChild(toast);
            
            // 停留2秒后显示关闭弹窗
            setTimeout(() => closeModal.classList.remove('hidden'), 2000);
            // 3秒后移除提示框
            setTimeout(() => toast.remove(), 3000);
        }
        
        // 5. 文字发送逻辑
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            convertToChatMode();
            addMessageToChat(message, 'user');
            showToast("或许《三傻大闹宝莱坞》是个不错的选择");
            
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // 简化响应逻辑（无随机，减少计算）
            setTimeout(() => addMessageToChat("感谢您的提问，我正在为您整理答案...", 'ai'), 1200);
        }
        
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        // 6. 语音输入逻辑
        voiceButton.addEventListener('click', () => voiceModal.classList.remove('hidden'));
        stopVoiceBtn.addEventListener('click', () => {
            voiceModal.classList.add('hidden');
            
            setTimeout(() => {
                const userText = "推荐一部喜剧电影。";
                convertToChatMode();
                addMessageToChat(userText, 'user');
                showToast("或许《喜剧之王》是个不错的选择"); // 触发延迟弹窗逻辑
                
                setTimeout(() => addMessageToChat("推荐您观看《喜剧之王》，这是一部情节紧凑的喜剧电影。", 'ai'), 1200);
                if (currentMode !== 'voice') voiceInputBtn.click();
            }, 500);
        });
        
        // 7. 核心：多端适配关闭网页逻辑
        closePageBtn.addEventListener('click', () => {
            closeModal.classList.add('hidden');
            const isWeChat = /MicroMessenger/i.test(navigator.userAgent);
            const isMobile = /Android|iPhone/i.test(navigator.userAgent);
            
            try {
                // 优先尝试标准关闭（适配电脑/多数手机浏览器）
                window.close();
                // 延迟检测，若未关闭则提示
                setTimeout(() => {
                    if (isWeChat) {
                        alert('微信浏览器需手动点击顶部"×"关闭');
                    } else if (isMobile) {
                        alert('请点击浏览器"关闭"按钮或返回键退出');
                    } else {
                        alert('请手动关闭浏览器标签页');
                    }
                }, 500);
            } catch (e) {
                alert('请手动关闭当前页面');
            }
        });
        
        // 8. 聊天模式切换（精简代码）
        function convertToChatMode() {
            const welcomeArea = document.querySelector('.flex-1.flex-col');
            if (welcomeArea) {
                welcomeArea.remove();
                const chatContainer = document.createElement('div');
                chatContainer.id = 'chat-container';
                chatContainer.className = 'flex-1 overflow-y-auto scrollbar-hide space-y-4 mb-4';
                mainContent.insertBefore(chatContainer, mainContent.firstChild);
            }
        }
        
        // 9. 添加聊天消息（精简代码）
        function addMessageToChat(message, sender) {
            const chatContainer = document.getElementById('chat-container');
            if (!chatContainer) return;
            
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex items-start ${sender === 'user' ? 'justify-end' : ''} space-x-3 animate-fade-in`;
            
            // 头像
            const avatar = document.createElement('div');
            avatar.className = `w-9 h-9 rounded-full flex-shrink-0 ${sender === 'user' ? 'bg-gray-200' : 'bg-gradient-ai'}`;
            const avatarImg = document.createElement('img');
            avatarImg.src = sender === 'user' ? 'https://picsum.photos/200/200?random=2' : 'https://picsum.photos/300/300?random=1';
            avatarImg.alt = `${sender === 'user' ? '用户' : '八妹AI'}头像`;
            avatarImg.className = 'w-full h-full object-cover rounded-full';
            avatar.appendChild(avatarImg);
            
            // 消息气泡
            const bubble = document.createElement('div');
            bubble.className = `px-4 py-2 rounded-2xl max-w-[75%] ${
                sender === 'user' ? 'bg-primary text-white rounded-tr-none' : 'bg-white text-gray-800 rounded-tl-none shadow-sm'
            }`;
            bubble.textContent = message;
            
            // 组装消息
            sender === 'user' ? msgDiv.append(bubble, avatar) : msgDiv.append(avatar, bubble);
            chatContainer.appendChild(msgDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
    </script>
</body>
</html>
