<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <title>搜索助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        neutral: '#F5F7FA',
                        light: '#F2F3F5'
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .bg-gradient-ai {
                background: linear-gradient(135deg, #165DFF 0%, #36CFC9 100%);
            }
            .scrollbar-hide {
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .toast-animation {
                animation: toast 3s ease-in-out forwards;
            }
            .animate-fade-in {
                animation: fadeIn 0.3s ease-out forwards;
                will-change: opacity, transform;
            }
            .animate-pulse {
                animation: pulse 1.5s infinite;
                will-change: transform;
            }
            .animate-float {
                animation: float 3s ease-in-out infinite;
                will-change: transform;
            }
            @keyframes toast {
                0% { opacity: 0; transform: translateY(20px); }
                20% { opacity: 1; transform: translateY(0); }
                80% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(20px); }
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(8px); }
                to { opacity: 1; transform: translateY(0); }
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            @keyframes float {
                0% { transform: translateY(0px); }
                50% { transform: translateY(-8px); }
                100% { transform: translateY(0px); }
            }
        }
    </style>
</head>
<body class="bg-neutral min-h-screen flex flex-col overflow-hidden">
    <!-- 开始界面 -->
    <div id="start-screen" class="fixed inset-0 bg-white flex flex-col items-center justify-center z-50">
        <div class="w-48 h-48 rounded-full bg-gradient-ai p-2 shadow-lg mb-8 animate-float">
            <img src="https://pic1.imgdb.cn/item/68be30a958cb8da5c887470f.png" 
                 alt="八妹AI形象" 
                 class="w-full h-full object-cover rounded-full"
                 width="192" 
                 height="192"
                 loading="lazy"
                 style="opacity:0;transition:opacity 0.3s ease"
                 onload="this.style.opacity=1">
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">嗨！我是小安</h1>
        <p class="text-gray-600 mb-8 text-center max-w-xs px-4">我可以帮你搜索、答疑、写作，请把你的任务交给我吧~</p>
        <button id="enter-button" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-full transition-all hover:scale-105 shadow-lg">
            开始使用
        </button>
    </div>

    <!-- 主要区域 -->
    <main class="flex-1 flex flex-col max-w-md w-full mx-auto p-4 opacity-0 transition-opacity duration-300">
        <!-- 欢迎区 -->
        <div class="flex-1 flex flex-col items-center justify-center text-center py-8">
            <div class="w-40 h-40 rounded-full bg-gradient-ai p-2 shadow-lg mb-6 animate-float">
                <img src="https://pic1.imgdb.cn/item/68be30a958cb8da5c887470f.png" 
                     alt="八妹AI形象" 
                     class="w-full h-full object-cover rounded-full"
                     width="160" 
                     height="160"
                     loading="lazy"
                     style="opacity:0;transition:opacity 0.3s ease"
                     onload="this.style.opacity=1">
            </div>
            <h1 class="text-2xl font-bold text-gray-800">嗨！我是小安</h1>
            <p class="text-gray-600 text-base max-w-xs mt-2">我可以帮你搜索、答疑、写作，请把你的任务交给我吧~</p>
        </div>
        
        <!-- 输入区 -->
        <div class="bg-white rounded-2xl shadow-md p-4 mb-6">
            <div class="flex items-center space-x-2 mb-3">
                <button id="text-input-btn" class="flex-1 py-2 rounded-lg bg-light text-gray-600 flex items-center justify-center space-x-2 transition-all">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2z"></path>
                    </svg>
                    <span>文字</span>
                </button>
                <button id="voice-input-btn" class="flex-1 py-2 rounded-lg bg-primary text-white flex items-center justify-center space-x-2 transition-all">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    <span>语音</span>
                </button>
            </div>
            
            <!-- 文字输入 (默认隐藏) -->
            <div id="text-input-container" class="hidden flex items-center space-x-2">
                <textarea id="message-input" 
                          class="flex-1 border-none outline-none resize-none h-12 text-base placeholder-gray-400" 
                          placeholder="请输入您的问题..."
                          autocorrect="off"
                          autocapitalize="off"
                          spellcheck="false"></textarea>
                <button id="send-btn" class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary/90 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0v8m8-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </button>
            </div>
            
            <!-- 语音输入 (默认显示) -->
            <div id="voice-input-container" class="py-6 flex flex-col items-center justify-center">
                <div id="voice-button" class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-3 cursor-pointer hover:bg-primary/20 transition-all">
                    <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                </div>
                <p class="text-gray-600 text-sm">点击说话</p>
            </div>
        </div>
    </main>

    <!-- 语音录音弹窗 -->
    <div id="voice-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-6 max-w-xs w-full text-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 mx-auto mb-4 flex items-center justify-center animate-pulse">
                <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-bold mb-1">正在录音</h3>
            <p class="text-gray-500 text-sm mb-4">请说出您的问题</p>
            <button id="stop-voice-btn" class="bg-primary text-white px-5 py-2 rounded-full text-sm hover:bg-primary/90 transition-colors">
                完成录音
            </button>
        </div>
    </div>

    <script>
        // 优化DOM查询性能，使用缓存
        const dom = {
            startScreen: document.getElementById('start-screen'),
            enterButton: document.getElementById('enter-button'),
            mainContent: document.querySelector('main'),
            textInputBtn: document.getElementById('text-input-btn'),
            voiceInputBtn: document.getElementById('voice-input-btn'),
            textInputContainer: document.getElementById('text-input-container'),
            voiceInputContainer: document.getElementById('voice-input-container'),
            messageInput: document.getElementById('message-input'),
            sendBtn: document.getElementById('send-btn'),
            voiceButton: document.getElementById('voice-button'),
            voiceModal: document.getElementById('voice-modal'),
            stopVoiceBtn: document.getElementById('stop-voice-btn'),
            chatContainer: null
        };
        
        let currentMode = 'voice';

        // 1. 快速进入主界面
        dom.enterButton.addEventListener('click', () => {
            dom.startScreen.classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => {
                dom.startScreen.style.display = 'none';
                dom.mainContent.classList.remove('opacity-0');
            }, 200); // 缩短过渡时间，加快响应
        });

        // 2. 切换输入模式
        dom.textInputBtn.addEventListener('click', () => {
            if (currentMode !== 'text') {
                currentMode = 'text';
                dom.textInputBtn.classList.replace('bg-light', 'bg-primary');
                dom.textInputBtn.classList.replace('text-gray-600', 'text-white');
                dom.voiceInputBtn.classList.replace('bg-primary', 'bg-light');
                dom.voiceInputBtn.classList.replace('text-white', 'text-gray-600');
                dom.textInputContainer.classList.remove('hidden');
                dom.voiceInputContainer.classList.add('hidden');
                dom.messageInput.focus();
            }
        });

        dom.voiceInputBtn.addEventListener('click', () => {
            if (currentMode !== 'voice') {
                currentMode = 'voice';
                dom.voiceInputBtn.classList.replace('bg-light', 'bg-primary');
                dom.voiceInputBtn.classList.replace('text-gray-600', 'text-white');
                dom.textInputBtn.classList.replace('bg-primary', 'bg-light');
                dom.textInputBtn.classList.replace('text-white', 'text-gray-600');
                dom.voiceInputContainer.classList.remove('hidden');
                dom.textInputContainer.classList.add('hidden');
            }
        });

        // 3. 文本框自适应高度
        dom.messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });

        // 4. 中间提示（优化创建逻辑，避免重复创建DOM）
        let centerTip = null;
        function showCenterTip(message) {
            if (!centerTip) {
                centerTip = document.createElement('div');
                centerTip.className = 'fixed inset-0 flex items-center justify-center pointer-events-none z-40';
                centerTip.innerHTML = '<div class="bg-primary text-white px-6 py-3 rounded-lg text-center toast-animation"></div>';
                document.body.appendChild(centerTip);
            }
            const tipContent = centerTip.querySelector('div');
            tipContent.textContent = message;
            // 重置动画
            tipContent.classList.remove('toast-animation');
            void tipContent.offsetWidth; // 触发重绘
            tipContent.classList.add('toast-animation');
        }

        // 5. 文字发送
        function sendMessage() {
            const msg = dom.messageInput.value.trim();
            if (!msg) return;
            
            convertToChatMode();
            addChatMsg(msg, 'user');
            showCenterTip("或许《喜剧之王》是个不错的选择");
            
            dom.messageInput.value = '';
            dom.messageInput.style.height = 'auto';
            
            setTimeout(() => addChatMsg("感谢您的提问，我正在为您整理答案...", 'ai'), 1000);
        }

        dom.sendBtn.addEventListener('click', sendMessage);
        dom.messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // 6. 语音输入
        dom.voiceButton.addEventListener('click', () => dom.voiceModal.classList.remove('hidden'));
        dom.stopVoiceBtn.addEventListener('click', () => {
            dom.voiceModal.classList.add('hidden');
            
            setTimeout(() => {
                const sampleMsg = "推荐一部好看的喜剧电影。";
                convertToChatMode();
                addChatMsg(sampleMsg, 'user');
                showCenterTip("或许《喜剧之王》是个不错的选择");
                
                setTimeout(() => addChatMsg("推荐您观看《喜剧之王》", 'ai'), 800);
                if (currentMode !== 'voice') dom.voiceInputBtn.click();
            }, 300);
        });

        // 7. 切换聊天模式
        function convertToChatMode() {
            if (dom.chatContainer) return;
            
            const welcomeArea = document.querySelector('.flex-1.flex-col');
            if (welcomeArea) {
                welcomeArea.remove();
                dom.chatContainer = document.createElement('div');
                dom.chatContainer.id = 'chat-container';
                dom.chatContainer.className = 'flex-1 overflow-y-auto scrollbar-hide space-y-4 mb-4';
                dom.mainContent.insertBefore(dom.chatContainer, dom.mainContent.firstChild);
            }
        }

        // 8. 添加聊天消息
        function addChatMsg(msg, sender) {
            if (!dom.chatContainer) return;
            
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex items-start ${sender === 'user' ? 'justify-end' : ''} space-x-3 animate-fade-in`;
            
            // 头像
            const avatar = document.createElement('div');
            avatar.className = `w-9 h-9 rounded-full flex-shrink-0 ${sender === 'user' ? 'bg-gray-200' : 'bg-gradient-ai'}`;
            avatar.innerHTML = `<img src="https://picsum.photos/36/36?random=${sender === 'user' ? 2 : 1}" 
                                    alt="${sender === 'user' ? '用户' : 'AI'}头像" 
                                    class="w-full h-full object-cover rounded-full"
                                    width="36" 
                                    height="36"
                                    loading="lazy">`;
            
            // 消息气泡
            const bubble = document.createElement('div');
            bubble.className = `px-4 py-2 rounded-2xl max-w-[75%] ${sender === 'user' ? 'bg-primary text-white rounded-tr-none' : 'bg-white text-gray-800 rounded-tl-none shadow-sm'}`;
            bubble.textContent = msg;
            
            // 组装
            sender === 'user' ? msgDiv.append(bubble, avatar) : msgDiv.append(avatar, bubble);
            dom.chatContainer.appendChild(msgDiv);
            dom.chatContainer.scrollTop = dom.chatContainer.scrollHeight;
        }

        // 移动端兼容性处理
        (function() {
            // 防止iOS双击缩放
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);

            // 确保在移动设备上正确获取视口高度
            function setAppHeight() {
                const doc = document.documentElement;
                doc.style.setProperty('--app-height', `${window.innerHeight}px`);
            }
            window.addEventListener('resize', setAppHeight);
            setAppHeight();
        })();
    </script>
</body>
</html>
