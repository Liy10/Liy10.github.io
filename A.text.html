<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡å›­æ–‡åˆ›çº¿ä¸Šå•†åŸ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            padding-bottom: 80px;
        }
        
        .view {
            display: none;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        .view.active {
            display: block;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #333;
            display: none;
            z-index: 10;
        }
        
        .back-btn.show {
            display: block;
        }

        /* é¦–é¡µæ ·å¼ */
        .home-view {
            text-align: center;
            padding-top: 60px;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }
        
        .search-input {
            width: 70%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 24px;
            font-size: 14px;
        }
        
        .search-btn {
            padding: 12px 20px;
            background-color: #224b8f;
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .search-error {
            color: #ff4d4f;
            margin-top: 15px;
            display: none;
        }
        
        .home-poster {
            margin-top: 30px;
            background-color: #fff;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: left;
        }
        
        .poster-img {
            width: 100%;
            margin: 20px 0 0;
            display: block;
            border-radius: 8px;
        }
        
        .poster-title {
            color: #224b8f;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .poster-desc {
            color: #666;
            line-height: 1.6;
        }
        
        .poster-highlight {
            color: #224b8f;
            font-weight: bold;
        }

        /* äº§å“è¯¦æƒ…é¡µ */
        .detail-view {
            padding-top: 60px;
            position: relative;
        }
        
        .detail-container {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-height: calc(100vh - 140px);
            display: flex;
            flex-direction: column;
            padding-bottom: 20px;
        }
        
        .detail-img-wrapper {
            flex: 1;
            overflow: hidden;
            position: relative;
            min-height: 40vh;
        }
        
        .detail-slider {
            display: flex;
            width: 200%;
            height: 100%;
            transition: transform 0.3s ease;
            touch-action: pan-y;
        }
        
        .detail-slide {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .detail-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .detail-info {
            padding: 15px;
        }
        
        .detail-title {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .detail-price {
            font-size: 18px;
            color: #224b8f;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .detail-spec {
            font-size: 14px;
            color: #666;
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        .detail-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            gap: 10px;
        }
        
        .indicator-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .indicator-img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .indicator-img.active {
            border: 2px solid #224b8f;
        }
        
        .detail-add-cart {
            padding: 10px 20px;
            background-color: #224b8f;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            white-space: nowrap;
            display: none;
        }
        
        .detail-add-cart.show {
            display: block;
        }

        /* åŠ å…¥è´­ç‰©è½¦é¡µ */
        .compare-view {
            padding-top: 60px;
            text-align: center;
        }
        
        .compare-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .compare-item {
            width: 45%;
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        
        .compare-img {
            width: 100%;
            height: 140px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .compare-title {
            font-size: 18px;
            margin-bottom: 5px;
            text-align: left;
        }
        
        .compare-price {
            font-size: 16px;
            color: #224b8f;
            text-align: left;
            margin-bottom: 10px;
        }
        
        .compare-spec {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
            text-align: left;
            flex-grow: 1;
        }
        
        .select-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 0 20px 30px;
        }
        
        .style-select {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .style-label {
            font-size: 16px;
            font-weight: 500;
        }
        
        .style-radio-group {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .radio-label {
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .quantity-select {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .quantity-label {
            font-size: 16px;
            font-weight: 500;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0;
        }
        
        .quantity-btn {
            width: 30px;
            height: 30px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 0;
            font-size: 16px;
            cursor: not-allowed;
            color: #999;
        }
        
        .quantity-btn:first-child {
            border-radius: 4px 0 0 4px;
        }
        
        .quantity-btn:last-child {
            border-radius: 0 4px 4px 0;
        }
        
        .quantity-input {
            width: 50px;
            height: 30px;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            border-left: none;
            border-right: none;
            text-align: center;
            font-size: 16px;
        }
        
        .compare-add-cart {
            padding: 12px;
            background-color: #224b8f;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }

        /* é—®å·é¡µé¢ */
        .survey-container {
            background-color: #fff;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0 30px;
        }
        
        .survey-title {
            font-size: 22px;
            color: #224b8f;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .survey-desc {
            color: #666;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .survey-item {
            margin-bottom: 20px;
        }
        
        .survey-question {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .rating-group {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        
        .gender-group {
            display: flex;
            gap: 15px;
        }
        
        .rating-group label,
        .gender-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        
        .survey-item input[type="text"],
        .survey-item input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .survey-submit-btn {
            width: 100%;
            padding: 14px;
            background-color: #224b8f;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* å›¾ç‰‡æ”¾å¤§æ•ˆæœ */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .image-modal.active {
            display: flex;
        }
        
        .modal-img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">â† è¿”å›</button>

    <!-- å›¾ç‰‡æ”¾å¤§æ¨¡æ€æ¡† -->
    <div class="image-modal" id="imageModal" onclick="closeModal()">
        <img class="modal-img" id="modalImg" src="" alt="æ”¾å¤§å›¾ç‰‡">
    </div>

    <!-- é¦–é¡µ -->
    <div class="view home-view active" id="homeView">
        <h2>æ ¡å›­æ–‡åˆ›çº¿ä¸Šå•†åŸ</h2>
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="åœ¨æ­¤è¾“å…¥â€œå……ç”µå®â€">
            <button class="search-btn" onclick="handleSearch()">æœç´¢</button>
        </div>
        <div class="search-error" id="searchError">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³äº§å“</div>
        <div class="home-poster">
            <div class="poster-title">ğŸ“¢ğŸ“¢ğŸ“¢ è®©æ ¡å›­æ–‡åˆ›æ›´æ‡‚ä½ ï¼</div>
            <div class="poster-desc">
                æ–‡åˆ›åº—æ–°ç½‘é¡µä¸Šçº¿æµ‹è¯•ä¸­ï½<br>
                æµè§ˆäº§å“å±•ç¤ºé¡µå¹¶ç•™ä¸‹ä½ çš„å»ºè®®å³å¯å‚ä¸æŠ½å¥–<br>
                å¥–å“ï¼š<span class="poster-highlight">30ä¸ªæ–‡åˆ›å……ç”µå®</span>ï¼Œæ•°é‡æœ‰é™å…ˆåˆ°å…ˆå¾—ï¼
            </div>
            <img src="https://youke1.picui.cn/s1/2025/11/12/6914445984c13.png" class="poster-img" alt="çº¿ä¸Šåº—æ´»åŠ¨æµ·æŠ¥">
        </div>
    </div>

    <!-- äº§å“è¯¦æƒ…é¡µ -->
    <div class="view detail-view" id="detailView">
        <div class="detail-container">
            <!-- äº§å“å›¾ç‰‡åŒºåŸŸ -->
            <div class="detail-img-wrapper">
                <div class="detail-slider" id="detailSlider">
                    <div class="detail-slide">
                        <img src="https://youke1.picui.cn/s1/2025/11/10/69119464e3bdc.png" class="detail-img" alt="å……ç”µå®M" onclick="showModal(this.src)">
                    </div>
                    <div class="detail-slide">
                        <img src="https://youke1.picui.cn/s1/2025/11/12/691450b372874.png" class="detail-img" alt="å……ç”µå®N" onclick="showModal(this.src)">
                    </div>
                </div>
            </div>
            <!-- äº§å“ä¿¡æ¯åŒºåŸŸ -->
            <div class="detail-info">
                <div class="detail-title" id="detailProductTitle">å……ç”µå® M</div>
                <div class="detail-price" id="detailProductPrice">Â¥99</div>
                <div class="detail-spec" id="detailProductSpec">
                    å……ç”µé€Ÿåº¦è¯„çº§ï¼š3çº§ï¼ˆç­‰çº§è¶Šé«˜ï¼Œå……ç”µé€Ÿåº¦è¶Šå¿«ï¼‰<br>
                    å…¶ä»–åŠŸèƒ½ç‰¹æ€§ï¼šç”µæ± å®¹é‡10000 mAhã€å•è¾“å…¥å•è¾“å‡ºæ¥å£<br>
                    é¢œè‰²æ¬¾å¼ï¼šå¤šç§é¢œè‰²ï¼ˆç™½ã€é»‘ã€è“ã€ç²‰ç­‰ï¼‰<br>
                    å…¶ä»–å¤–è§‚ç‰¹æ€§ï¼šè½»è–„å°å·§ã€æµçº¿å‹è®¾è®¡ã€é¢œå€¼é«˜
                </div>
            </div>
            <!-- åº•éƒ¨æ§åˆ¶æ  -->
            <div class="detail-controls">
                <div class="indicator-container">
                    <img class="indicator-img active" data-index="0" onclick="slideTo(0)" src="https://youke1.picui.cn/s1/2025/11/10/69119464e3bdc.png" alt="å……ç”µå®Mç¼©ç•¥å›¾">
                    <img class="indicator-img" data-index="1" onclick="slideTo(1)" src="https://youke1.picui.cn/s1/2025/11/12/691450b372874.png" alt="å……ç”µå®Nç¼©ç•¥å›¾">
                </div>
                <button class="detail-add-cart" id="detailAddCartBtn" onclick="goToCompareView()">åŠ å…¥è´­ç‰©è½¦</button>
            </div>
        </div>
    </div>

    <!-- åŠ å…¥è´­ç‰©è½¦é¡µ -->
    <div class="view compare-view" id="compareView">
        <div class="compare-container">
            <div class="compare-item">
                <img src="https://youke1.picui.cn/s1/2025/11/10/69119464e3bdc.png" class="compare-img" onclick="showModal(this.src)">
                <div class="compare-title">å……ç”µå® M</div>
                <div class="compare-price">Â¥99</div>
                <div class="compare-spec">
                    å……ç”µé€Ÿåº¦è¯„çº§ï¼š3çº§<br>
                    ç”µæ± å®¹é‡ï¼š10000 mAh<br>
                    æ¥å£ï¼šå•è¾“å…¥å•è¾“å‡º<br>
                    é¢œè‰²ï¼šå¤šç§é¢œè‰²å¯é€‰<br>
                    ç‰¹ç‚¹ï¼šè½»è–„å°å·§ã€æµçº¿å‹è®¾è®¡
                </div>
            </div>
            <div class="compare-item">
                <img src="https://youke1.picui.cn/s1/2025/11/12/691450b372874.png" class="compare-img" onclick="showModal(this.src)">
                <div class="compare-title">å……ç”µå® N</div>
                <div class="compare-price">Â¥99</div>
                <div class="compare-spec">
                    å……ç”µé€Ÿåº¦è¯„çº§ï¼š5çº§<br>
                    ç”µæ± å®¹é‡ï¼š20000 mAh<br>
                    æ¥å£ï¼šå•è¾“å…¥åŒè¾“å‡º<br>
                    é¢œè‰²ï¼šä»…é»‘è‰²<br>
                    ç‰¹ç‚¹ï¼šç®€çº¦æ–¹æ­£è®¾è®¡ã€å¤§å®¹é‡
                </div>
            </div>
        </div>
        <div class="select-container">
            <!-- æ¬¾å¼é€‰æ‹© -->
            <div class="style-select">
                <span class="style-label">æ¬¾å¼ï¼š</span>
                <div class="style-radio-group">
                    <label class="radio-label">
                        <input type="radio" name="product" value="M" checked> å……ç”µå® M
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="product" value="N"> å……ç”µå® N
                    </label>
                </div>
            </div>
            <!-- æ•°é‡é€‰æ‹© -->
            <div class="quantity-select">
                <span class="quantity-label">æ•°é‡ï¼š</span>
                <div class="quantity-control">
                    <button class="quantity-btn" disabled>-</button>
                    <input type="number" class="quantity-input" value="1" min="1" max="1" readonly>
                    <button class="quantity-btn" disabled>+</button>
                </div>
            </div>
            <button class="compare-add-cart" onclick="compareAddToCart()">åŠ å…¥è´­ç‰©è½¦</button>
        </div>
    </div>

    <!-- é—®å·ç¬¬ä¸€é¡µ -->
    <div class="view survey1-view" id="survey1View">
        <div class="survey-container">
            <div class="survey-title">é—®å·è°ƒç ”</div>
            <div class="survey-desc">
                ä¸ºäº†æ›´å¥½åœ°äº†è§£æ ¡å›­ç”¨æˆ·çš„éœ€æ±‚ï¼Œè¯·å¡«å†™ä¸‹æ–¹ä¿¡æ¯ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬å®Œå–„çº¿ä¸Šå•†åŸå¹¶è®¾è®¡å‡ºæ›´ç¬¦åˆå¤§å®¶æœŸå¾…çš„æ–‡åˆ›äº§å“ã€‚<br>
                æˆ‘ä»¬æ‰¿è¯ºï¼šæ‰€æœ‰ä¿¡æ¯ä»…ç”¨äºäº§å“è®¾è®¡ç ”ç©¶ï¼Œä¸¥æ ¼ä¿å¯†ã€‚
            </div>
            <form id="survey1Form">
                <div class="survey-item">
                    <div class="survey-question">1. è¯·æ‚¨å¯¹åˆšæ‰çš„ç½‘ç«™è®¾è®¡ä¸æœç´¢ä½“éªŒè¿›è¡Œè¯„ä»·ã€‚</div>
                     <div class="question-instruction">ï¼ˆ1=ä¸€ç‚¹éƒ½ä¸å¥½ï¼Œ7=éå¸¸å¥½ï¼‰</div>
                    <div class="rating-group">
                        <label><input type="radio" name="websiteRating" value="1" required> 1</label>
                        <label><input type="radio" name="websiteRating" value="2"> 2</label>
                        <label><input type="radio" name="websiteRating" value="3"> 3</label>
                        <label><input type="radio" name="websiteRating" value="4"> 4</label>
                        <label><input type="radio" name="websiteRating" value="5"> 5</label>
                        <label><input type="radio" name="websiteRating" value="6"> 6</label>
                        <label><input type="radio" name="websiteRating" value="7"> 7</label>
                    </div>
                </div>
                <div class="survey-item">
                    <div class="survey-question">2. æ‚¨å¹³æ—¶ä½¿ç”¨å……ç”µå®çš„é¢‘ç‡ï¼Ÿ</div> 
                     <div class="question-instruction">ï¼ˆ1=ä¸€ç‚¹éƒ½ä¸é¢‘ç¹ï¼Œ7=éå¸¸é¢‘ç¹ï¼‰</div>
                    <div class="rating-group">
                        <label><input type="radio" name="usageFrequency" value="1" required> 1</label>
                        <label><input type="radio" name="usageFrequency" value="2"> 2</label>
                        <label><input type="radio" name="usageFrequency" value="3"> 3</label>
                        <label><input type="radio" name="usageFrequency" value="4"> 4</label>
                        <label><input type="radio" name="usageFrequency" value="5"> 5</label>
                        <label><input type="radio" name="usageFrequency" value="6"> 6</label>
                        <label><input type="radio" name="usageFrequency" value="7"> 7</label>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- é—®å·ç¬¬äºŒé¡µ -->
    <div class="view survey2-view" id="survey2View">
        <div class="survey-container">
            <div class="survey-title">åŸºç¡€ä¿¡æ¯æ”¶é›†</div>
            <div class="survey-desc">
                æœ¬é¡µä¸ºåç»­ç¤¼å“å‘æ”¾æ”¶é›†åŸºæœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä¸¥æ ¼ä¿å¯†æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚
            </div>
            <form id="survey2Form">
                <div class="survey-item">
                    <div class="survey-question">1. æ‚¨çš„æ€§åˆ«ï¼š</div>
                    <div class="gender-group">
                        <label><input type="radio" name="gender" value="ç”·" required> ç”·</label>
                        <label><input type="radio" name="gender" value="å¥³"> å¥³</label>
                    </div>
                </div>
                <div class="survey-item">
                    <div class="survey-question">2. æ‚¨çš„å¹´é¾„ï¼š</div>
                    <input type="number" name="age" min="10" max="100" required placeholder="è¯·è¾“å…¥å¹´é¾„">
                </div>
                <div class="survey-item">
                    <div class="survey-question">3. æ‰‹æœºå·åå››ä½ï¼š</div>
                    <input type="text" name="phoneLast4" pattern="\d{4}" required placeholder="è¯·è¾“å…¥æ‰‹æœºå·åå››ä½">
                </div>
                <button type="submit" class="survey-submit-btn">æäº¤</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <script>
        // åˆå§‹åŒ–LeanCloud
        AV.init({
          appId: "BRIeJxj8NmBJ5kJ8J7y81US1-gzGzoHsz",
          appKey: "Y6B011SA2WjsGg4uRBZ1bktj",
          serverURL: "https://briejxj8.lc-cn-n1-shared.com"
        });

        // é¡µé¢å…ƒç´ å¼•ç”¨
        const pageElements = {
            home: document.getElementById('homeView'),
            detail: document.getElementById('detailView'),
            compare: document.getElementById('compareView'),
            survey1: document.getElementById('survey1View'),
            survey2: document.getElementById('survey2View')
        };
        const searchInput = document.getElementById('searchInput');
        const searchError = document.getElementById('searchError');
        const backBtn = document.querySelector('.back-btn');
        const detailSlider = document.getElementById('detailSlider');
        const indicators = document.querySelectorAll('.indicator-img');
        const detailTitle = document.getElementById('detailProductTitle');
        const detailSpec = document.getElementById('detailProductSpec');
        const detailAddCartBtn = document.getElementById('detailAddCartBtn');
        const imageModal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImg');

        // äº§å“æ•°æ®
        const productData = [
            {
                title: 'å……ç”µå® M',
                spec: 'å……ç”µé€Ÿåº¦è¯„çº§ï¼š3çº§ï¼ˆç­‰çº§è¶Šé«˜ï¼Œå……ç”µé€Ÿåº¦è¶Šå¿«ï¼‰<br>å…¶ä»–åŠŸèƒ½ç‰¹æ€§ï¼šç”µæ± å®¹é‡10000 mAhã€å•è¾“å…¥å•è¾“å‡ºæ¥å£<br>é¢œè‰²æ¬¾å¼ï¼šå¤šç§é¢œè‰²ï¼ˆç™½ã€é»‘ã€è“ã€ç²‰ç­‰ï¼‰<br>å…¶ä»–å¤–è§‚ç‰¹æ€§ï¼šè½»è–„å°å·§ã€æµçº¿å‹è®¾è®¡ã€é¢œå€¼é«˜'
            },
            {
                title: 'å……ç”µå® N',
                spec: 'å……ç”µé€Ÿåº¦è¯„çº§ï¼š5çº§ï¼ˆç­‰çº§è¶Šé«˜ï¼Œå……ç”µé€Ÿåº¦è¶Šå¿«ï¼‰<br>å…¶ä»–åŠŸèƒ½ç‰¹æ€§ï¼šç”µæ± å®¹é‡20000 mAhã€å•è¾“å…¥åŒè¾“å‡ºæ¥å£<br>é¢œè‰²æ¬¾å¼ï¼šä»…é»‘è‰²<br>å…¶ä»–å¤–è§‚ç‰¹æ€§ï¼šç®€çº¦æ–¹æ­£è®¾è®¡ã€é¢œå€¼é€‚ä¸­'
            }
        ];

        // å…¨å±€å˜é‡
        let currentPage = 'home';
        let pageHistory = [];
        let currentSlideIndex = 0;
        let surveyData = {};

        // æœç´¢åŠŸèƒ½
        function handleSearch() {
            const inputVal = searchInput.value.trim();
            searchError.classList.remove('show');
            
            if (inputVal.includes('ç”µ') || inputVal.includes('å®')) {
                navigateTo('detail');
                slideTo(0);
            } else {
                searchError.classList.add('show');
            }
        }

        // é¡µé¢å¯¼èˆª
        function navigateTo(page) {
            pageHistory.push(currentPage);
            currentPage = page;
            Object.values(pageElements).forEach(view => view.classList.remove('active'));
            pageElements[page].classList.add('active');
            backBtn.classList.toggle('show', page !== 'home');
        }

        // äº§å“æ»‘åŠ¨åˆ‡æ¢
        function slideTo(index) {
            currentSlideIndex = index;
            detailSlider.style.transform = `translateX(-${50 * index}%)`;
            indicators.forEach((ind, i) => ind.classList.toggle('active', i === index));
            
            // æ›´æ–°äº§å“ä¿¡æ¯
            detailTitle.textContent = productData[index].title;
            detailSpec.innerHTML = productData[index].spec;
            
            // åªåœ¨Næ¬¾æ˜¾ç¤ºåŠ å…¥è´­ç‰©è½¦æŒ‰é’®
            detailAddCartBtn.classList.toggle('show', index === 1);
        }

        // æ»‘åŠ¨æ‰‹åŠ¿æ”¯æŒ
        detailSlider.addEventListener('touchstart', (e) => {
            window.touchStartX = e.touches[0].clientX;
        });
        detailSlider.addEventListener('touchend', (e) => {
            const diffX = e.changedTouches[0].clientX - window.touchStartX;
            if (diffX < -50 && currentSlideIndex < 1) slideTo(1);
            if (diffX > 50 && currentSlideIndex > 0) slideTo(0);
        });

        // å›¾ç‰‡æ”¾å¤§åŠŸèƒ½
        function showModal(src) {
            modalImg.src = src;
            imageModal.classList.add('active');
        }

        function closeModal() {
            imageModal.classList.remove('active');
        }

        // è·³è½¬åˆ°å¯¹æ¯”é¡µ
        function goToCompareView() {
            navigateTo('compare');
        }

        // å¯¹æ¯”é¡µåŠ å…¥è´­ç‰©è½¦
        function compareAddToCart() {
            const selected = document.querySelector('input[name="product"]:checked').value;
            alert(`å……ç”µå® ${selected} å·²åŠ å…¥è´­ç‰©è½¦ï¼`);

            // ä¿å­˜é€‰æ‹©æ•°æ®
            const UserChoice = AV.Object.extend('UserChoices');
            new UserChoice().save({
                productType: selected,
                chooseTime: new Date(),
                anonymousId: Math.random().toString(36).substr(2, 9)
            }).catch(err => console.log('æ•°æ®ä¿å­˜å¤±è´¥ï¼š', err.message));

            navigateTo('survey1');
        }

        // é—®å·è‡ªåŠ¨æäº¤é€»è¾‘
        function setupSurveyAutoSubmit() {
            const form = document.getElementById('survey1Form');
            const websiteRatingInputs = form.querySelectorAll('input[name="websiteRating"]');
            const usageFrequencyInputs = form.querySelectorAll('input[name="usageFrequency"]');
            
            // æ£€æŸ¥æ˜¯å¦ä¸¤ä¸ªé—®é¢˜éƒ½å·²å›ç­”
            function checkAndSubmit() {
                const websiteRating = form.querySelector('input[name="websiteRating"]:checked');
                const usageFrequency = form.querySelector('input[name="usageFrequency"]:checked');
                
                if (websiteRating && usageFrequency) {
                    // è‡ªåŠ¨æäº¤è¡¨å•
                    const formData = new FormData(form);
                    surveyData = {
                        websiteRating: formData.get('websiteRating'),
                        usageFrequency: formData.get('usageFrequency')
                    };
                    navigateTo('survey2');
                }
            }
            
            // ä¸ºæ‰€æœ‰å•é€‰æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
            websiteRatingInputs.forEach(input => {
                input.addEventListener('change', checkAndSubmit);
            });
            
            usageFrequencyInputs.forEach(input => {
                input.addEventListener('change', checkAndSubmit);
            });
        }

        // é—®å·ç¬¬äºŒé¡µæäº¤
        document.getElementById('survey2Form').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            Object.assign(surveyData, {
                gender: formData.get('gender'),
                age: formData.get('age'),
                phoneLast4: formData.get('phoneLast4'),
                anonymousId: Math.random().toString(36).substr(2, 9),
                submitTime: new Date()
            });

            // ä¸Šä¼ é—®å·æ•°æ®
            const SurveyResponse = AV.Object.extend('SurveyResponses');
            new SurveyResponse().save(surveyData).catch(err => console.log('é—®å·ä¿å­˜å¤±è´¥ï¼š', err.message));

            alert('æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼æˆ‘ä»¬å°†å°½å¿«æŠ½å–å¹¸è¿ç”¨æˆ·å‘æ”¾ç¤¼å“');
            pageHistory = [];
            navigateTo('home');
        });

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (pageHistory.length > 0) {
                const prevPage = pageHistory.pop();
                currentPage = prevPage;
                Object.values(pageElements).forEach(view => view.classList.remove('active'));
                pageElements[prevPage].classList.add('active');
                backBtn.classList.toggle('show', prevPage !== 'home');
            }
        }

        // åˆå§‹åŒ–é—®å·è‡ªåŠ¨æäº¤
        setupSurveyAutoSubmit();
    </script>
</body>
</html>
