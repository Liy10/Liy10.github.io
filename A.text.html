<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡å›­æ–‡åˆ›çº¿ä¸Šå•†åŸ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background-color: #f5f5f5; padding-bottom: 80px; }
        .view { display: none; width: 100%; max-width: 600px; margin: 0 auto; padding: 20px; min-height: 100vh; }
        .view.active { display: block; }
        .back-btn { position: absolute; top: 20px; left: 20px; background: none; border: none; font-size: 18px; cursor: pointer; color: #333; display: none; z-index: 10; }
        .back-btn.show { display: block; }

        /* é¦–é¡µæ ·å¼ */
        .home-view { text-align: center; padding-top: 60px; }
        .search-box { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 20px; }
        .search-input { width: 70%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 24px; font-size: 14px; }
        .search-input::placeholder { color: #000; font-weight: bold; }
        .search-btn { padding: 12px 20px; background-color: #224b8f; color: white; border: none; border-radius: 24px; cursor: pointer; font-size: 16px; }
        .search-error { color: #ff4d4f; margin-top: 15px; display: none; }
        .home-poster { margin-top: 30px; background-color: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: left; }
        .poster-img { width: 100%; margin: 20px 0 0; display: block; border-radius: 8px; }
        .poster-title { color: #224b8f; font-size: 18px; font-weight: bold; margin-bottom: 8px; }
        .poster-desc { color: #666; line-height: 1.6; }
        .poster-highlight { color: #224b8f; font-weight: bold; }

        /* äº§å“è¯¦æƒ…é¡µ */
        .detail-view { padding-top: 60px; position: relative; }
        .detail-container { background-color: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); min-height: calc(100vh - 140px); display: flex; flex-direction: column; padding-bottom: 20px; }
        .detail-img-wrapper { flex: 1; overflow: hidden; position: relative; min-height: 40vh; }
        .detail-slider { display: flex; width: 200%; height: 100%; transition: transform 0.3s ease; touch-action: pan-y; }
        .detail-slide { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .detail-img { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; cursor: pointer; }
        .detail-info { padding: 15px; }
        .detail-title { font-size: 20px; margin-bottom: 5px; }
        .detail-price { font-size: 18px; color: #224b8f; font-weight: bold; margin-bottom: 15px; }
        .detail-spec { font-size: 14px; color: #666; line-height: 1.8; margin-bottom: 20px; }
        .detail-controls { display: flex; flex-direction: column; padding: 0 15px; gap: 15px; }
        .indicator-container { display: flex; align-items: center; justify-content: center; gap: 10px; }
        .indicator-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid transparent; }
        .indicator-img.active { border: 2px solid #224b8f; }
        .detail-add-cart { padding: 15px; background-color: #224b8f; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 100%; margin-top: 10px; display: none; }
        .detail-add-cart.show { display: block; }

        /* åŠ å…¥è´­ç‰©è½¦é¡µ */
        .compare-view { padding-top: 60px; text-align: center; }
        .compare-container { display: flex; justify-content: center; gap: 20px; margin: 30px 0; }
        .compare-item { width: 45%; background-color: #fff; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .compare-img { width: 100%; height: 140px; object-fit: contain; border-radius: 8px; margin-bottom: 10px; cursor: pointer; }
        .compare-title { font-size: 18px; margin-bottom: 5px; text-align: left; }
        .compare-price { font-size: 16px; color: #224b8f; text-align: left; margin-bottom: 10px; }
        .compare-spec { font-size: 12px; color: #666; line-height: 1.5; text-align: left; flex-grow: 1; }
        .select-container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 0 20px 30px; }
        .style-select, .quantity-select { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .style-label, .quantity-label { font-size: 16px; font-weight: 500; }
        
        /* ä¿®æ”¹åçš„æ¬¾å¼é€‰æ‹©æ ·å¼ */
        .style-options { display: flex; gap: 15px; }
        .style-option { 
            width: 120px; 
            height: 40px; 
            border: 2px solid #224b8f; 
            border-radius: 4px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            background-color: white; 
            color: #224b8f;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        .style-option.selected { 
            background-color: #224b8f; 
            color: white; 
        }
        
        .quantity-control { display: flex; align-items: center; gap: 0; }
        .quantity-btn { width: 30px; height: 30px; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 0; font-size: 16px; cursor: not-allowed; color: #999; }
        .quantity-btn:first-child { border-radius: 4px 0 0 4px; }
        .quantity-btn:last-child { border-radius: 0 4px 4px 0; }
        .quantity-input { width: 50px; height: 30px; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; border-left: none; border-right: none; text-align: center; font-size: 16px; }
        .compare-add-cart { padding: 12px; background-color: #224b8f; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 100%; }

        /* é—®å·é¡µé¢ */
        .survey-container { background-color: #fff; border-radius: 8px; padding: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 60px 0 30px; }
        .survey-title { font-size: 22px; color: #224b8f; margin-bottom: 15px; text-align: center; }
        .survey-desc { color: #666; line-height: 1.6; margin-bottom: 30px; }
        .survey-item { margin-bottom: 30px; }
        .survey-question { font-size: 16px; margin-bottom: 15px; }
        .scale-labels { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; color: #666; }
        .rating-group { display: flex; justify-content: space-between; gap: 8px; margin-top: 10px; }
        .rating-box { flex: 1; height: 40px; display: flex; align-items: center; justify-content: center; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; font-weight: bold; }
        .rating-box:hover { background-color: #e9ecef; }
        .rating-box.selected { background-color: #224b8f; color: white; border-color: #224b8f; }
        .gender-group { display: flex; gap: 15px; }
        .survey-item input[type="text"], .survey-item input[type="number"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; margin-top: 5px; }
        .survey-submit-btn, .lottery-btn { width: 100%; padding: 14px; background-color: #224b8f; color: white; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; margin-top: 10px; }

        /* å›¾ç‰‡æ”¾å¤§æ•ˆæœ */
        .image-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 100; }
        .image-modal.active { display: flex; }
        .modal-img { max-width: 90%; max-height: 90%; object-fit: contain; }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">â† è¿”å›</button>

    <!-- å›¾ç‰‡æ”¾å¤§æ¨¡æ€æ¡† -->
    <div class="image-modal" id="imageModal" onclick="closeModal()">
        <img class="modal-img" id="modalImg" src="" alt="æ”¾å¤§å›¾ç‰‡">
    </div>

    <!-- é¦–é¡µ -->
    <div class="view home-view active" id="homeView">
        <h2>æ ¡å›­æ–‡åˆ›çº¿ä¸Šå•†åŸ</h2>
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="åœ¨æ­¤è¾“å…¥â€œå……ç”µå®â€">
            <button class="search-btn" onclick="handleSearch()">æœç´¢</button>
        </div>
        <div class="search-error" id="searchError">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³äº§å“</div>
        <div class="home-poster">
            <div class="poster-title">ğŸ“¢ğŸ“¢ğŸ“¢ è®©æ ¡å›­æ–‡åˆ›æ›´æ‡‚ä½ ï¼</div>
            <div class="poster-desc">
                æ–‡åˆ›åº—æ–°ç½‘é¡µä¸Šçº¿æµ‹è¯•ä¸­ï½<br>
                æµè§ˆäº§å“å±•ç¤ºé¡µå¹¶ç•™ä¸‹ä½ çš„å»ºè®®å³å¯å‚ä¸æŠ½å¥–<br>
                å¥–å“ï¼š<span class="poster-highlight">30ä¸ªæ–‡åˆ›å……ç”µå®</span>ï¼Œæ•°é‡æœ‰é™å…ˆåˆ°å…ˆå¾—ï¼
            </div>
            <img src="https://youke1.picui.cn/s1/2025/11/12/6914445984c13.png" class="poster-img" alt="çº¿ä¸Šåº—æ´»åŠ¨æµ·æŠ¥">
        </div>
    </div>

    <!-- äº§å“è¯¦æƒ…é¡µ -->
    <div class="view detail-view" id="detailView">
        <div class="detail-container">
            <!-- äº§å“å›¾ç‰‡åŒºåŸŸ -->
            <div class="detail-img-wrapper">
                <div class="detail-slider" id="detailSlider">
                    <div class="detail-slide">
                        <img src="https://youke1.picui.cn/s1/2025/11/10/69119464e3bdc.png" class="detail-img" alt="å……ç”µå®M" onclick="showModal(this.src)">
                    </div>
                    <div class="detail-slide">
                        <img src="https://youke1.picui.cn/s1/2025/11/12/691450b372874.png" class="detail-img" alt="å……ç”µå®N" onclick="showModal(this.src)">
                    </div>
                </div>
            </div>
            
            <!-- ç¼©ç•¥å›¾åŒºåŸŸ -->
            <div class="detail-controls">
                <div class="indicator-container">
                    <img class="indicator-img active" data-index="0" onclick="slideTo(0)" src="https://youke1.picui.cn/s1/2025/11/10/69119464e3bdc.png" alt="å……ç”µå®Mç¼©ç•¥å›¾">
                    <img class="indicator-img" data-index="1" onclick="slideTo(1)" src="https://youke1.picui.cn/s1/2025/11/12/691450b372874.png" alt="å……ç”µå®Nç¼©ç•¥å›¾">
                </div>
            </div>
            
            <!-- äº§å“ä¿¡æ¯åŒºåŸŸ -->
            <div class="detail-info">
                <div class="detail-title" id="detailProductTitle">å……ç”µå® M</div>
                <div class="detail-price" id="detailProductPrice">Â¥99</div>
                <div class="detail-spec" id="detailProductSpec">
                    å……ç”µé€Ÿåº¦è¯„çº§ï¼š3çº§ï¼ˆç­‰çº§è¶Šé«˜ï¼Œå……ç”µé€Ÿåº¦è¶Šå¿«ï¼‰<br>
                    å…¶ä»–åŠŸèƒ½ç‰¹æ€§ï¼šç”µæ± å®¹é‡10000 mAhã€å•è¾“å…¥å•è¾“å‡ºæ¥å£<br>
                    é¢œè‰²æ¬¾å¼ï¼šå¤šç§é¢œè‰²ï¼ˆç™½ã€é»‘ã€è“ã€ç²‰ç­‰ï¼‰<br>
                    å…¶ä»–å¤–è§‚ç‰¹æ€§ï¼šè½»è–„å°å·§ã€æµçº¿å‹è®¾è®¡ã€é¢œå€¼é«˜
                </div>
            </div>
            
            <!-- åŠ å…¥è´­ç‰©è½¦æŒ‰é’® -->
            <div class="detail-controls">
                <button class="detail-add-cart" id="detailAddCartBtn" onclick="goToCompareView()">åŠ å…¥è´­ç‰©è½¦</button>
            </div>
        </div>
    </div>

    <!-- åŠ å…¥è´­ç‰©è½¦é¡µ -->
    <div class="view compare-view" id="compareView">
        <div class="compare-container">
            <div class="compare-item">
                <img src="https://youke1.picui.cn/s1/2025/11/10/69119464e3bdc.png" class="compare-img" onclick="showModal(this.src)">
                <div class="compare-title">å……ç”µå® M</div>
                <div class="compare-price">Â¥99</div>
                <div class="compare-spec">
                    å……ç”µé€Ÿåº¦è¯„çº§ï¼š3çº§<br>
                    ç”µæ± å®¹é‡ï¼š10000 mAh<br>
                    æ¥å£ï¼šå•è¾“å…¥å•è¾“å‡º<br>
                    é¢œè‰²ï¼šå¤šç§é¢œè‰²å¯é€‰<br>
                    ç‰¹ç‚¹ï¼šè½»è–„å°å·§ã€æµçº¿å‹è®¾è®¡
                </div>
            </div>
            <div class="compare-item">
                <img src="https://youke1.picui.cn/s1/2025/11/12/691450b372874.png" class="compare-img" onclick="showModal(this.src)">
                <div class="compare-title">å……ç”µå® N</div>
                <div class="compare-price">Â¥99</div>
                <div class="compare-spec">
                    å……ç”µé€Ÿåº¦è¯„çº§ï¼š5çº§<br>
                    ç”µæ± å®¹é‡ï¼š20000 mAh<br>
                    æ¥å£ï¼šå•è¾“å…¥åŒè¾“å‡º<br>
                    é¢œè‰²ï¼šä»…é»‘è‰²<br>
                    ç‰¹ç‚¹ï¼šç®€çº¦æ–¹æ­£è®¾è®¡ã€å¤§å®¹é‡
                </div>
            </div>
        </div>
        <div class="select-container">
            <!-- æ¬¾å¼é€‰æ‹© -->
            <div class="style-select">
                <span class="style-label">æ¬¾å¼ï¼š</span>
                <div class="style-options">
                    <div class="style-option" data-value="M">å……ç”µå® M</div>
                    <div class="style-option" data-value="N">å……ç”µå® N</div>
                </div>
            </div>
            <!-- æ•°é‡é€‰æ‹© -->
            <div class="quantity-select">
                <span class="quantity-label">æ•°é‡ï¼š</span>
                <div class="quantity-control">
                    <button class="quantity-btn" disabled>-</button>
                    <input type="number" class="quantity-input" value="1" min="1" max="1" readonly>
                    <button class="quantity-btn" disabled>+</button>
                </div>
            </div>
            <button class="compare-add-cart" onclick="compareAddToCart()">åŠ å…¥è´­ç‰©è½¦</button>
        </div>
    </div>

    <!-- é—®å·ç¬¬ä¸€é¡µ -->
    <div class="view survey1-view" id="survey1View">
        <div class="survey-container">
            <div class="survey-title">é—®å·è°ƒç ”</div>
            <div class="survey-desc">
                ä¸ºäº†æ›´å¥½åœ°äº†è§£æ ¡å›­ç”¨æˆ·çš„éœ€æ±‚ï¼Œè¯·å¡«å†™ä¸‹æ–¹ä¿¡æ¯ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬å®Œå–„çº¿ä¸Šå•†åŸå¹¶è®¾è®¡å‡ºæ›´ç¬¦åˆå¤§å®¶æœŸå¾…çš„æ–‡åˆ›äº§å“ã€‚<br>
                æˆ‘ä»¬æ‰¿è¯ºï¼šæ‰€æœ‰ä¿¡æ¯ä»…ç”¨äºäº§å“è®¾è®¡ç ”ç©¶ï¼Œä¸¥æ ¼ä¿å¯†ã€‚
            </div>
            <form id="survey1Form">
                <div class="survey-item">
                    <div class="survey-question">1. è¯·æ‚¨å¯¹åˆšæ‰çš„ç½‘ç«™è®¾è®¡ä¸æœç´¢ä½“éªŒè¿›è¡Œè¯„ä»·ã€‚</div>
                    <div class="scale-labels">
                        <span>1=ä¸€ç‚¹éƒ½ä¸å¥½</span>
                        <span>7=éå¸¸å¥½</span>
                    </div>
                    <div class="rating-group">
                        <div class="rating-box" data-value="1">1</div>
                        <div class="rating-box" data-value="2">2</div>
                        <div class="rating-box" data-value="3">3</div>
                        <div class="rating-box" data-value="4">4</div>
                        <div class="rating-box" data-value="5">5</div>
                        <div class="rating-box" data-value="6">6</div>
                        <div class="rating-box" data-value="7">7</div>
                    </div>
                    <input type="hidden" name="websiteRating" id="websiteRating" required>
                </div>
                <div class="survey-item">
                    <div class="survey-question">2. æ‚¨å¹³æ—¶ä½¿ç”¨å……ç”µå®çš„é¢‘ç‡ï¼Ÿ</div> 
                    <div class="scale-labels">
                        <span>1=ä¸€ç‚¹éƒ½ä¸é¢‘ç¹</span>
                        <span>7=éå¸¸é¢‘ç¹</span>
                    </div>
                    <div class="rating-group">
                        <div class="rating-box" data-value="1">1</div>
                        <div class="rating-box" data-value="2">2</div>
                        <div class="rating-box" data-value="3">3</div>
                        <div class="rating-box" data-value="4">4</div>
                        <div class="rating-box" data-value="5">5</div>
                        <div class="rating-box" data-value="6">6</div>
                        <div class="rating-box" data-value="7">7</div>
                    </div>
                    <input type="hidden" name="usageFrequency" id="usageFrequency" required>
                </div>
                <button type="button" class="lottery-btn" id="lotteryBtn">ç‚¹å‡»æŠ½å¥–</button>
            </form>
        </div>
    </div>

    <!-- é—®å·ç¬¬äºŒé¡µ -->
    <div class="view survey2-view" id="survey2View">
        <div class="survey-container">
            <div class="survey-title">åŸºç¡€ä¿¡æ¯æ”¶é›†</div>
            <div class="survey-desc">
                æœ¬é¡µä¸ºåç»­ç¤¼å“å‘æ”¾æ”¶é›†åŸºæœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä¸¥æ ¼ä¿å¯†æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚
            </div>
            <form id="survey2Form">
                <div class="survey-item">
                    <div class="survey-question">1. æ‚¨çš„æ€§åˆ«ï¼š</div>
                    <div class="gender-group">
                        <label><input type="radio" name="gender" value="ç”·" required> ç”·</label>
                        <label><input type="radio" name="gender" value="å¥³"> å¥³</label>
                    </div>
                </div>
                <div class="survey-item">
                    <div class="survey-question">2. æ‚¨çš„å¹´é¾„ï¼š</div>
                    <input type="number" name="age" min="10" max="100" required placeholder="è¯·è¾“å…¥å¹´é¾„">
                </div>
                <div class="survey-item">
                    <div class="survey-question">3. æ‰‹æœºå·åå››ä½ï¼š</div>
                    <input type="text" name="phoneLast4" pattern="\d{4}" required placeholder="è¯·è¾“å…¥æ‰‹æœºå·åå››ä½">
                </div>
                <button type="submit" class="survey-submit-btn">æäº¤</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <script>
        // åˆå§‹åŒ–LeanCloud
        AV.init({
          appId: "BRIeJxj8NmBJ5kJ8J7y81US1-gzGzoHsz",
          appKey: "Y6B011SA2WjsGg4uRBZ1bktj",
          serverURL: "https://briejxj8.lc-cn-n1-shared.com"
        });

        // é¡µé¢å…ƒç´ å¼•ç”¨
        const pageElements = {
            home: document.getElementById('homeView'),
            detail: document.getElementById('detailView'),
            compare: document.getElementById('compareView'),
            survey1: document.getElementById('survey1View'),
            survey2: document.getElementById('survey2View')
        };
        const searchInput = document.getElementById('searchInput');
        const searchError = document.getElementById('searchError');
        const backBtn = document.querySelector('.back-btn');
        const detailSlider = document.getElementById('detailSlider');
        const indicators = document.querySelectorAll('.indicator-img');
        const detailTitle = document.getElementById('detailProductTitle');
        const detailSpec = document.getElementById('detailProductSpec');
        const detailAddCartBtn = document.getElementById('detailAddCartBtn');
        const imageModal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImg');
        const lotteryBtn = document.getElementById('lotteryBtn');

        // äº§å“æ•°æ®
        const productData = [
            {
                title: 'å……ç”µå® M',
                spec: 'å……ç”µé€Ÿåº¦è¯„çº§ï¼š3çº§ï¼ˆç­‰çº§è¶Šé«˜ï¼Œå……ç”µé€Ÿåº¦è¶Šå¿«ï¼‰<br>å…¶ä»–åŠŸèƒ½ç‰¹æ€§ï¼šç”µæ± å®¹é‡10000 mAhã€å•è¾“å…¥å•è¾“å‡ºæ¥å£<br>é¢œè‰²æ¬¾å¼ï¼šå¤šç§é¢œè‰²ï¼ˆç™½ã€é»‘ã€è“ã€ç²‰ç­‰ï¼‰<br>å…¶ä»–å¤–è§‚ç‰¹æ€§ï¼šè½»è–„å°å·§ã€æµçº¿å‹è®¾è®¡ã€é¢œå€¼é«˜'
            },
            {
                title: 'å……ç”µå® N',
                spec: 'å……ç”µé€Ÿåº¦è¯„çº§ï¼š5çº§ï¼ˆç­‰çº§è¶Šé«˜ï¼Œå……ç”µé€Ÿåº¦è¶Šå¿«ï¼‰<br>å…¶ä»–åŠŸèƒ½ç‰¹æ€§ï¼šç”µæ± å®¹é‡20000 mAhã€å•è¾“å…¥åŒè¾“å‡ºæ¥å£<br>é¢œè‰²æ¬¾å¼ï¼šä»…é»‘è‰²<br>å…¶ä»–å¤–è§‚ç‰¹æ€§ï¼šç®€çº¦æ–¹æ­£è®¾è®¡ã€é¢œå€¼é€‚ä¸­'
            }
        ];

        // å…¨å±€å˜é‡
        let currentPage = 'home';
        let pageHistory = [];
        let currentSlideIndex = 0;
        let surveyData = {};
        let touchStartX = 0;
        let selectedProduct = ''; // å­˜å‚¨ç”¨æˆ·é€‰æ‹©çš„å……ç”µå®æ¬¾å¼

        // æœç´¢åŠŸèƒ½
        function handleSearch() {
            const inputVal = searchInput.value.trim();
            searchError.classList.remove('show');
            
            if (inputVal.includes('ç”µ') || inputVal.includes('å®')) {
                navigateTo('detail');
                slideTo(0);
            } else {
                searchError.classList.add('show');
            }
        }

        // é¡µé¢å¯¼èˆª
        function navigateTo(page) {
            pageHistory.push(currentPage);
            currentPage = page;
            Object.values(pageElements).forEach(view => view.classList.remove('active'));
            pageElements[page].classList.add('active');
            backBtn.classList.toggle('show', page !== 'home');
            
            // åˆå§‹åŒ–æ¬¾å¼é€‰æ‹©ï¼ˆå½“è¿›å…¥compareé¡µé¢æ—¶ï¼‰
            if (page === 'compare') {
                initStyleSelection();
            }
        }

        // äº§å“æ»‘åŠ¨åˆ‡æ¢
        function slideTo(index) {
            currentSlideIndex = index;
            detailSlider.style.transform = `translateX(-${50 * index}%)`;
            indicators.forEach((ind, i) => ind.classList.toggle('active', i === index));
            
            // æ›´æ–°äº§å“ä¿¡æ¯
            detailTitle.textContent = productData[index].title;
            detailSpec.innerHTML = productData[index].spec;
            
            // åªåœ¨Næ¬¾æ˜¾ç¤ºåŠ å…¥è´­ç‰©è½¦æŒ‰é’®
            detailAddCartBtn.classList.toggle('show', index === 1);
        }

        // æ»‘åŠ¨æ‰‹åŠ¿æ”¯æŒ - æ•´ä¸ªé¡µé¢éƒ½å¯ä»¥æ»‘åŠ¨
        document.getElementById('detailView').addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });
        
        document.getElementById('detailView').addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const diffX = touchEndX - touchStartX;
            
            if (diffX < -50 && currentSlideIndex < 1) {
                slideTo(1);
            } else if (diffX > 50 && currentSlideIndex > 0) {
                slideTo(0);
            }
        });

        // å›¾ç‰‡æ”¾å¤§åŠŸèƒ½
        function showModal(src) {
            modalImg.src = src;
            imageModal.classList.add('active');
        }

        function closeModal() {
            imageModal.classList.remove('active');
        }

        // è·³è½¬åˆ°å¯¹æ¯”é¡µ
        function goToCompareView() {
            navigateTo('compare');
        }

        // åˆå§‹åŒ–æ¬¾å¼é€‰æ‹©
        function initStyleSelection() {
            const styleOptions = document.querySelectorAll('.style-option');
            
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©çŠ¶æ€
            styleOptions.forEach(option => option.classList.remove('selected'));
            selectedProduct = '';
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            styleOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                    styleOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // è®¾ç½®å½“å‰é€‰é¡¹ä¸ºé€‰ä¸­çŠ¶æ€
                    this.classList.add('selected');
                    
                    // æ›´æ–°é€‰ä¸­çš„äº§å“
                    selectedProduct = this.getAttribute('data-value');
                });
            });
        }

        // å¯¹æ¯”é¡µåŠ å…¥è´­ç‰©è½¦
        function compareAddToCart() {
            if (!selectedProduct) {
                alert('è¯·é€‰æ‹©ä¸€æ¬¾å……ç”µå®');
                return;
            }
            
            alert(`å……ç”µå® ${selectedProduct} å·²åŠ å…¥è´­ç‰©è½¦ï¼`);
            navigateTo('survey1');
        }

        // é—®å·é€»è¾‘
        function setupSurvey() {
            const form = document.getElementById('survey1Form');
            const ratingBoxes = document.querySelectorAll('.rating-box');
            const websiteRatingInput = document.getElementById('websiteRating');
            const usageFrequencyInput = document.getElementById('usageFrequency');
            
            // ä¸ºæ‰€æœ‰è¯„åˆ†æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬
            ratingBoxes.forEach(box => {
                box.addEventListener('click', function() {
                    const question = this.parentElement;
                    const allBoxes = question.querySelectorAll('.rating-box');
                    
                    // ç§»é™¤åŒç»„å…¶ä»–æ¡†çš„é€‰ä¸­çŠ¶æ€
                    allBoxes.forEach(b => b.classList.remove('selected'));
                    
                    // è®¾ç½®å½“å‰æ¡†ä¸ºé€‰ä¸­çŠ¶æ€
                    this.classList.add('selected');
                    
                    // æ›´æ–°å¯¹åº”çš„éšè—è¾“å…¥æ¡†å€¼
                    if (question.previousElementSibling.previousElementSibling.textContent.includes('ç½‘ç«™è®¾è®¡ä¸æœç´¢ä½“éªŒ')) {
                        websiteRatingInput.value = this.getAttribute('data-value');
                    } else {
                        usageFrequencyInput.value = this.getAttribute('data-value');
                    }
                });
            });
            
            // æŠ½å¥–æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            lotteryBtn.addEventListener('click', function() {
                const websiteRating = websiteRatingInput.value;
                const usageFrequency = usageFrequencyInput.value;
                
                if (websiteRating && usageFrequency) {
                    surveyData = {
                        websiteRating: websiteRating,
                        usageFrequency: usageFrequency,
                        selectedProduct: selectedProduct // ä¿å­˜ç”¨æˆ·é€‰æ‹©çš„å……ç”µå®æ¬¾å¼
                    };
                    navigateTo('survey2');
                } else {
                    alert('è¯·å…ˆå®Œæˆä¸¤ä¸ªé—®é¢˜çš„è¯„åˆ†');
                }
            });
        }

        // é—®å·ç¬¬äºŒé¡µæäº¤
        document.getElementById('survey2Form').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            // åˆå¹¶æ‰€æœ‰æ•°æ®
            Object.assign(surveyData, {
                gender: formData.get('gender'),
                age: formData.get('age'),
                phoneLast4: formData.get('phoneLast4'),
                anonymousId: Math.random().toString(36).substr(2, 9),
                submitTime: new Date()
            });

            // ä¸Šä¼ æ‰€æœ‰æ•°æ®åˆ°SurveyResponsesè¡¨
            const SurveyResponse = AV.Object.extend('SurveyResponses');
            new SurveyResponse().save(surveyData).then(() => {
                alert('æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼æˆ‘ä»¬å°†å°½å¿«æŠ½å–å¹¸è¿ç”¨æˆ·å‘æ”¾ç¤¼å“');
                pageHistory = [];
                navigateTo('home');
            }).catch(err => {
                console.log('é—®å·ä¿å­˜å¤±è´¥ï¼š', err.message);
                alert('æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            });
        });

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (pageHistory.length > 0) {
                const prevPage = pageHistory.pop();
                currentPage = prevPage;
                Object.values(pageElements).forEach(view => view.classList.remove('active'));
                pageElements[prevPage].classList.add('active');
                backBtn.classList.toggle('show', prevPage !== 'home');
            }
        }

        // åˆå§‹åŒ–é—®å·
        setupSurvey();
    </script>
</body>
</html>
