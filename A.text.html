<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ ¡å›­æ–‡åˆ›çº¿ä¸Šå•†åŸ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif; }
        body { background-color: #f5f5f5; color: #333; line-height: 1.5; }
        .view { display: none; width: 100%; max-width: 600px; margin: 0 auto; padding: 20px; min-height: 100vh; }
        .view.active { display: block; }
        .back-btn { position: fixed; top: 15px; left: 15px; background: none; border: none; font-size: 18px; cursor: pointer; color: #333; display: none; z-index: 10; padding: 8px; }
        .back-btn.show { display: block; }

        /* é¦–é¡µæ ·å¼ */
        .home-view { text-align: center; padding-top: 60px; }
        .search-box { display: flex; align-items: center; justify-content: center; gap: 8px; margin: 20px 0; }
        .search-input { flex: 1; padding: 12px 15px; border: 1px solid #ddd; border-radius: 24px; font-size: 14px; max-width: 70%; }
        .search-input::placeholder { color: #333; font-weight: bold; } /* åŠ æ·±é¢œè‰² */
        .search-btn { padding: 12px 20px; background-color: #224b8f; color: white; border: none; border-radius: 24px; font-size: 16px; cursor: pointer; }
        .search-error { color: #ff4d4f; margin-top: 10px; display: none; }
        .home-poster { margin-top: 30px; background-color: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .poster-img { width: 100%; margin: 15px 0 0; border-radius: 8px; }
        .poster-title { color: #224b8f; font-size: 18px; font-weight: bold; margin-bottom: 8px; }
        .poster-desc { color: #666; }
        .poster-highlight { color: #224b8f; font-weight: bold; }

        /* äº§å“è¯¦æƒ…é¡µ */
        .detail-view { padding-top: 60px; }
        .detail-container { background-color: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); min-height: calc(100vh - 140px); display: flex; flex-direction: column; }
        .detail-img-wrapper { position: relative; overflow: hidden; min-height: 40vh; }
        .detail-slider { display: flex; width: 200%; height: 100%; transition: transform 0.3s ease; }
        .detail-slide { width: 50%; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .detail-img { max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; }
        .detail-info { padding: 15px; }
        .detail-title { font-size: 20px; margin-bottom: 5px; }
        .detail-price { font-size: 18px; color: #224b8f; font-weight: bold; margin-bottom: 15px; }
        .detail-spec { font-size: 14px; color: #666; margin-bottom: 15px; }
        .detail-controls { padding: 0 15px 15px; }
        .indicator-container { display: flex; justify-content: center; gap: 10px; margin: 10px 0; }
        .indicator-img { width: 45px; height: 45px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid transparent; }
        .indicator-img.active { border-color: #224b8f; }
        .detail-add-cart { padding: 15px; background-color: #224b8f; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 100%; margin-top: 10px; display: none; }
        .detail-add-cart.show { display: block; }

        /* åŠ å…¥è´­ç‰©è½¦é¡µ - ä¼˜åŒ– */
        .compare-view { padding-top: 60px; }
        .compare-container { 
            display: flex; 
            gap: 15px; 
            margin: 20px 0; 
            flex-wrap: nowrap; /* ç¡®ä¿ä¸æ¢è¡Œ */
            overflow-x: auto; /* å…è®¸æ°´å¹³æ»šåŠ¨ */
            padding-bottom: 10px; /* ä¸ºæ»šåŠ¨æ¡ç•™ç©ºé—´ */
        }
        .compare-item { 
            flex: 0 0 48%; /* å›ºå®šå®½åº¦ï¼Œç¡®ä¿ä¸¤ä¸ªé¡¹ç›®å¹¶æ’ */
            min-width: 280px; /* æœ€å°å®½åº¦ç¡®ä¿å†…å®¹å¯è¯» */
            background-color: #fff; 
            border-radius: 8px; 
            padding: 15px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .compare-img { width: 100%; height: 140px; object-fit: contain; border-radius: 8px; margin-bottom: 10px; }
        .compare-title { font-size: 18px; margin-bottom: 5px; }
        .compare-price { font-size: 16px; color: #224b8f; margin-bottom: 10px; }
        .compare-spec { font-size: 12px; color: #666; }
        .select-container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 0 0 30px; }
        .style-select, .quantity-select { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .style-label, .quantity-label { font-size: 16px; font-weight: 500; }
        .style-options { display: flex; gap: 10px; }
        .style-option { width: 100px; height: 35px; border: 2px solid #224b8f; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; background-color: white; color: #224b8f; font-weight: bold; font-size: 14px; }
        .style-option.selected { background-color: #224b8f; color: white; }
        .quantity-control { display: flex; align-items: center; }
        .quantity-btn { width: 30px; height: 30px; background-color: #f5f5f5; border: 1px solid #ddd; font-size: 16px; cursor: not-allowed; color: #999; }
        .quantity-btn:first-child { border-radius: 4px 0 0 4px; }
        .quantity-btn:last-child { border-radius: 0 4px 4px 0; }
        .quantity-input { width: 50px; height: 30px; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; border-left: none; border-right: none; text-align: center; font-size: 16px; }
        .compare-add-cart { padding: 12px; background-color: #224b8f; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 100%; }

        /* é—®å·é¡µé¢ */
        .survey-container { background-color: #fff; border-radius: 8px; padding: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 60px 0 30px; }
        .survey-title { font-size: 22px; color: #224b8f; margin-bottom: 15px; text-align: center; }
        .survey-desc { color: #666; margin-bottom: 30px; }
        .survey-item { margin-bottom: 30px; }
        .survey-question { font-size: 16px; margin-bottom: 15px; }
        .scale-labels { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; color: #666; }
        .rating-group { display: flex; gap: 8px; margin-top: 10px; }
        .rating-box { flex: 1; height: 40px; display: flex; align-items: center; justify-content: center; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .rating-box.selected { background-color: #224b8f; color: white; border-color: #224b8f; }
        .gender-group { display: flex; gap: 15px; }
        .usage-group { display: flex; flex-direction: column; gap: 10px; }
        .usage-option { display: flex; align-items: center; gap: 8px; }
        .survey-item input[type="text"], .survey-item input[type="number"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; margin-top: 5px; }
        .survey-submit-btn, .next-btn { width: 100%; padding: 14px; background-color: #224b8f; color: white; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; margin-top: 10px; }
        
        /* æŠ½å¥–é¡µé¢ */
        .lottery-view { padding-top: 60px; text-align: center; }
        .lottery-title { font-size: 24px; color: #224b8f; margin-bottom: 30px; }
        .loading-container { text-align: center; padding: 40px 0; }
        .loading-spinner { width: 60px; height: 60px; border: 5px solid #f3f3f3; border-top: 5px solid #224b8f; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { font-size: 16px; color: #666; }
        .lottery-result { text-align: center; padding: 20px; display: none; }
        .lottery-result.active { display: block; }
        .lottery-icon { font-size: 60px; margin-bottom: 20px; }
        .lottery-message { font-size: 18px; margin-bottom: 15px; }
        .lottery-thanks { color: #666; }

        /* å›¾ç‰‡æ”¾å¤§æ•ˆæœ */
        .image-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 100; }
        .image-modal.active { display: flex; }
        .modal-img { max-width: 90%; max-height: 90%; object-fit: contain; }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .compare-item { 
                flex: 0 0 85%; /* åœ¨å°å±å¹•ä¸Šç¨å¾®å¢åŠ å®½åº¦ */
                min-width: 250px;
            }
            .select-container { padding: 15px; }
            .style-options { justify-content: center; }
            .style-option { width: 90px; height: 32px; font-size: 13px; }
            .detail-img-wrapper { min-height: 35vh; }
            .indicator-img { width: 40px; height: 40px; }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">â† è¿”å›</button>

    <!-- å›¾ç‰‡æ”¾å¤§æ¨¡æ€æ¡† -->
    <div class="image-modal" id="imageModal" onclick="closeModal()">
        <img class="modal-img" id="modalImg" src="" alt="æ”¾å¤§å›¾ç‰‡">
    </div>

    <!-- é¦–é¡µ -->
    <div class="view home-view active" id="homeView">
        <h2>æ ¡å›­æ–‡åˆ›çº¿ä¸Šå•†åŸ</h2>
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="åœ¨æ­¤è¾“å…¥"å……ç”µå®"">
            <button class="search-btn" onclick="handleSearch()">æœç´¢</button>
        </div>
        <div class="search-error" id="searchError">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³äº§å“</div>
        <div class="home-poster">
            <div class="poster-title">è®©æ ¡å›­æ–‡åˆ›æ›´æ‡‚ä½ ï¼</div>
            <div class="poster-desc">
                ğŸ“¢ æ–‡åˆ›ç½‘åº—ä¸Šçº¿æµ‹è¯•ä¸­ï½<br>
                æµè§ˆäº§å“å±•ç¤ºé¡µå¹¶ç•™ä¸‹ä½ çš„å»ºè®®å³å¯å‚ä¸æŠ½å¥–<br>
                å¥–å“ï¼š<span class="poster-highlight">30ä¸ªæ–‡åˆ›å……ç”µå®</span>ï¼Œæ•°é‡æœ‰é™å…ˆåˆ°å…ˆå¾—ï¼
            </div>
            <img src="https://youke1.picui.cn/s1/2025/11/12/6914445984c13.png" class="poster-img" alt="çº¿ä¸Šåº—æ´»åŠ¨æµ·æŠ¥">
        </div>
    </div>

    <!-- äº§å“è¯¦æƒ…é¡µ -->
    <div class="view detail-view" id="detailView">
        <div class="detail-container">
            <div class="detail-img-wrapper">
                <div class="detail-slider" id="detailSlider">
                    <div class="detail-slide">
                        <img src="https://youke1.picui.cn/s1/2025/11/10/69119464e3bdc.png" class="detail-img" alt="å……ç”µå®M" onclick="showModal(this.src)">
                    </div>
                    <div class="detail-slide">
                        <img src="https://youke1.picui.cn/s1/2025/11/12/691450b372874.png" class="detail-img" alt="å……ç”µå®N" onclick="showModal(this.src)">
                    </div>
                </div>
            </div>
            
            <div class="detail-controls">
                <div class="indicator-container">
                    <img class="indicator-img active" data-index="0" onclick="slideTo(0)" src="https://youke1.picui.cn/s1/2025/11/10/69119464e3bdc.png" alt="å……ç”µå®Mç¼©ç•¥å›¾">
                    <img class="indicator-img" data-index="1" onclick="slideTo(1)" src="https://youke1.picui.cn/s1/2025/11/12/691450b372874.png" alt="å……ç”µå®Nç¼©ç•¥å›¾">
                </div>
            </div>
            
            <div class="detail-info">
                <div class="detail-title" id="detailProductTitle">å……ç”µå® M</div>
                <div class="detail-price" id="detailProductPrice">Â¥99</div>
                <div class="detail-spec" id="detailProductSpec">
                    å……ç”µé€Ÿåº¦è¯„çº§ï¼š3çº§ï¼ˆç­‰çº§è¶Šé«˜ï¼Œå……ç”µé€Ÿåº¦è¶Šå¿«ï¼‰<br>
                    å…¶ä»–åŠŸèƒ½ç‰¹æ€§ï¼šç”µæ± å®¹é‡10000 mAhã€å•è¾“å…¥å•è¾“å‡ºæ¥å£<br>
                    é¢œè‰²æ¬¾å¼ï¼šå¤šç§é¢œè‰²ï¼ˆç™½ã€é»‘ã€è“ã€ç²‰ç­‰ï¼‰<br>
                    å…¶ä»–å¤–è§‚ç‰¹æ€§ï¼šè½»è–„å°å·§ã€æµçº¿å‹è®¾è®¡ã€é¢œå€¼é«˜
                </div>
            </div>
            
            <div class="detail-controls">
                <button class="detail-add-cart" id="detailAddCartBtn" onclick="goToCompareView()">åŠ å…¥è´­ç‰©è½¦</button>
            </div>
        </div>
    </div>

    <!-- åŠ å…¥è´­ç‰©è½¦é¡µ -->
    <div class="view compare-view" id="compareView">
        <div class="compare-container">
            <div class="compare-item">
                <img src="https://youke1.picui.cn/s1/2025/11/10/69119464e3bdc.png" class="compare-img" onclick="showModal(this.src)">
                <div class="compare-title">å……ç”µå® M</div>
                <div class="compare-price">Â¥99</div>
                <div class="compare-spec">
                    å……ç”µé€Ÿåº¦è¯„çº§ï¼š3çº§<br>
                    ç”µæ± å®¹é‡ï¼š10000 mAh<br>
                    æ¥å£ï¼šå•è¾“å…¥å•è¾“å‡º<br>
                    é¢œè‰²ï¼šå¤šç§é¢œè‰²å¯é€‰<br>
                    ç‰¹ç‚¹ï¼šè½»è–„å°å·§ã€æµçº¿å‹è®¾è®¡
                </div>
            </div>
            <div class="compare-item">
                <img src="https://youke1.picui.cn/s1/2025/11/12/691450b372874.png" class="compare-img" onclick="showModal(this.src)">
                <div class="compare-title">å……ç”µå® N</div>
                <div class="compare-price">Â¥99</div>
                <div class="compare-spec">
                    å……ç”µé€Ÿåº¦è¯„çº§ï¼š5çº§<br>
                    ç”µæ± å®¹é‡ï¼š20000 mAh<br>
                    æ¥å£ï¼šå•è¾“å…¥åŒè¾“å‡º<br>
                    é¢œè‰²ï¼šä»…é»‘è‰²<br>
                    ç‰¹ç‚¹ï¼šç®€çº¦æ–¹æ­£è®¾è®¡ã€å¤§å®¹é‡
                </div>
            </div>
        </div>
        <div class="select-container">
            <div class="style-select">
                <span class="style-label">æ¬¾å¼ï¼š</span>
                <div class="style-options">
                    <div class="style-option" data-value="M">å……ç”µå® M</div>
                    <div class="style-option" data-value="N">å……ç”µå® N</div>
                </div>
            </div>
            <div class="quantity-select">
                <span class="quantity-label">æ•°é‡ï¼š</span>
                <div class="quantity-control">
                    <button class="quantity-btn" disabled>-</button>
                    <input type="number" class="quantity-input" value="1" min="1" max="1" readonly>
                    <button class="quantity-btn" disabled>+</button>
                </div>
            </div>
            <button class="compare-add-cart" onclick="compareAddToCart()">åŠ å…¥è´­ç‰©è½¦</button>
        </div>
    </div>

    <!-- é—®å·ç¬¬ä¸€é¡µ -->
    <div class="view survey1-view" id="survey1View">
        <div class="survey-container">
            <div class="survey-title">é—®å·è°ƒç ”</div>
            <div class="survey-desc">
                ä¸ºäº†æ›´å¥½åœ°äº†è§£æ ¡å›­ç”¨æˆ·çš„éœ€æ±‚ï¼Œè¯·å¡«å†™ä¸‹æ–¹ä¿¡æ¯ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬å®Œå–„çº¿ä¸Šå•†åŸå¹¶è®¾è®¡å‡ºæ›´ç¬¦åˆå¤§å®¶æœŸå¾…çš„æ–‡åˆ›äº§å“ã€‚
            </div>
            <form id="survey1Form">
                <div class="survey-item">
                    <div class="survey-question">1. è¯·æ‚¨å¯¹åˆšæ‰çš„ç½‘ç«™è®¾è®¡ä¸æœç´¢ä½“éªŒè¿›è¡Œè¯„ä»·ã€‚</div>
                    <div class="scale-labels">
                        <span>1=ä¸€ç‚¹éƒ½ä¸å¥½</span>
                        <span>7=éå¸¸å¥½</span>
                    </div>
                    <div class="rating-group">
                        <div class="rating-box" data-value="1">1</div>
                        <div class="rating-box" data-value="2">2</div>
                        <div class="rating-box" data-value="3">3</div>
                        <div class="rating-box" data-value="4">4</div>
                        <div class="rating-box" data-value="5">5</div>
                        <div class="rating-box" data-value="6">6</div>
                        <div class="rating-box" data-value="7">7</div>
                    </div>
                    <input type="hidden" name="websiteRating" id="websiteRating" required>
                </div>
                <div class="survey-item">
                    <div class="survey-question">2. æ‚¨æ˜¯å¦ä½¿ç”¨è¿‡è¿™ä¸¤æ¬¾å……ç”µå®ï¼Ÿ</div>
                    <div class="usage-group">
                        <label class="usage-option">
                            <input type="radio" name="usage" value="ä½¿ç”¨è¿‡Mæ¬¾" required> ä½¿ç”¨è¿‡Mæ¬¾
                        </label>
                        <label class="usage-option">
                            <input type="radio" name="usage" value="ä½¿ç”¨è¿‡Næ¬¾"> ä½¿ç”¨è¿‡Næ¬¾
                        </label>
                        <label class="usage-option">
                            <input type="radio" name="usage" value="ä¸¤è€…éƒ½ä½¿ç”¨è¿‡"> ä¸¤è€…éƒ½ä½¿ç”¨è¿‡
                        </label>
                        <label class="usage-option">
                            <input type="radio" name="usage" value="ä¸¤è€…éƒ½æ²¡ä½¿ç”¨è¿‡"> ä¸¤è€…éƒ½æ²¡ä½¿ç”¨è¿‡
                        </label>
                    </div>
                </div>
                <button type="button" class="next-btn" id="nextBtn">ä¸‹ä¸€æ­¥</button>
            </form>
        </div>
    </div>

    <!-- é—®å·ç¬¬äºŒé¡µ -->
    <div class="view survey2-view" id="survey2View">
        <div class="survey-container">
            <div class="survey-title">åŸºç¡€ä¿¡æ¯æ”¶é›†</div>
            <div class="survey-desc">
                æœ¬é¡µä¸ºåç»­å¥–å“å‘æ”¾æ”¶é›†åŸºæœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä¸¥æ ¼ä¿å¯†æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚
            </div>
            <form id="survey2Form">
                <div class="survey-item">
                    <div class="survey-question">1. æ‚¨çš„æ€§åˆ«ï¼š</div>
                    <div class="gender-group">
                        <label><input type="radio" name="gender" value="ç”·" required> ç”·</label>
                        <label><input type="radio" name="gender" value="å¥³"> å¥³</label>
                    </div>
                </div>
                <div class="survey-item">
                    <div class="survey-question">2. æ‚¨çš„å¹´é¾„ï¼š</div>
                    <input type="number" name="age" min="10" max="100" required placeholder="è¯·è¾“å…¥å¹´é¾„">
                </div>
                <div class="survey-item">
                    <div class="survey-question">3. æ‰‹æœºå·åå››ä½ï¼š</div>
                    <input type="text" name="phoneLast4" pattern="\d{4}" required placeholder="è¯·è¾“å…¥æ‰‹æœºå·åå››ä½">
                </div>
                <button type="submit" class="survey-submit-btn">ç‚¹å‡»æŠ½å¥–</button>
            </form>
        </div>
    </div>

    <!-- æŠ½å¥–é¡µé¢ -->
    <div class="view lottery-view" id="lotteryView">
        <div class="survey-container">
            <div class="lottery-title">æŠ½å¥–ç»“æœ</div>
            
            <div class="loading-container" id="loadingContainer">
                <div class="loading-spinner"></div>
                <div class="loading-text">æŠ½å¥–ä¸­ï¼Œè¯·ç¨å€™...</div>
            </div>
            
            <div class="lottery-result" id="lotteryResult">
                <div class="lottery-icon">ğŸ</div>
                <div class="lottery-message">å¾ˆé—æ†¾ï¼Œæ‚¨æœªä¸­å¥–</div>
                <div class="lottery-thanks">
                    æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼<br>
                    æ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬éå¸¸é‡è¦ï¼Œå¸®åŠ©æˆ‘ä»¬ä¸æ–­æ”¹è¿›æ ¡å›­æ–‡åˆ›äº§å“å’ŒæœåŠ¡ã€‚
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <script>
        // åˆå§‹åŒ–LeanCloud
        AV.init({
          appId: "BRIeJxj8NmBJ5kJ8J7y81US1-gzGzoHsz",
          appKey: "Y6B011SA2WjsGg4uRBZ1bktj",
          serverURL: "https://briejxj8.lc-cn-n1-shared.com"
        });

        // é¡µé¢å…ƒç´ å¼•ç”¨
        const pageElements = {
            home: document.getElementById('homeView'),
            detail: document.getElementById('detailView'),
            compare: document.getElementById('compareView'),
            survey1: document.getElementById('survey1View'),
            survey2: document.getElementById('survey2View'),
            lottery: document.getElementById('lotteryView')
        };
        const searchInput = document.getElementById('searchInput');
        const searchError = document.getElementById('searchError');
        const backBtn = document.querySelector('.back-btn');
        const detailSlider = document.getElementById('detailSlider');
        const indicators = document.querySelectorAll('.indicator-img');
        const detailTitle = document.getElementById('detailProductTitle');
        const detailSpec = document.getElementById('detailProductSpec');
        const detailAddCartBtn = document.getElementById('detailAddCartBtn');
        const imageModal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImg');
        const nextBtn = document.getElementById('nextBtn');
        const loadingContainer = document.getElementById('loadingContainer');
        const lotteryResult = document.getElementById('lotteryResult');

        // äº§å“æ•°æ®
        const productData = [
            {
                title: 'å……ç”µå® M',
                spec: 'å……ç”µé€Ÿåº¦è¯„çº§ï¼š3çº§ï¼ˆç­‰çº§è¶Šé«˜ï¼Œå……ç”µé€Ÿåº¦è¶Šå¿«ï¼‰<br>å…¶ä»–åŠŸèƒ½ç‰¹æ€§ï¼šç”µæ± å®¹é‡10000 mAhã€å•è¾“å…¥å•è¾“å‡ºæ¥å£<br>é¢œè‰²æ¬¾å¼ï¼šå¤šç§é¢œè‰²ï¼ˆç™½ã€é»‘ã€è“ã€ç²‰ç­‰ï¼‰<br>å…¶ä»–å¤–è§‚ç‰¹æ€§ï¼šè½»è–„å°å·§ã€æµçº¿å‹è®¾è®¡ã€é¢œå€¼é«˜'
            },
            {
                title: 'å……ç”µå® N',
                spec: 'å……ç”µé€Ÿåº¦è¯„çº§ï¼š5çº§ï¼ˆç­‰çº§è¶Šé«˜ï¼Œå……ç”µé€Ÿåº¦è¶Šå¿«ï¼‰<br>å…¶ä»–åŠŸèƒ½ç‰¹æ€§ï¼šç”µæ± å®¹é‡20000 mAhã€å•è¾“å…¥åŒè¾“å‡ºæ¥å£<br>é¢œè‰²æ¬¾å¼ï¼šä»…é»‘è‰²<br>å…¶ä»–å¤–è§‚ç‰¹æ€§ï¼šç®€çº¦æ–¹æ­£è®¾è®¡ã€é¢œå€¼é€‚ä¸­'
            }
        ];

        // å…¨å±€å˜é‡
        let currentPage = 'home';
        let pageHistory = [];
        let currentSlideIndex = 0;
        let surveyData = {};
        let touchStartX = 0;
        let selectedProduct = '';

        // æœç´¢åŠŸèƒ½
        function handleSearch() {
            const inputVal = searchInput.value.trim();
            searchError.style.display = 'none';
            
            if (inputVal.includes('ç”µ') || inputVal.includes('å®')) {
                navigateTo('detail');
                slideTo(0);
            } else {
                searchError.style.display = 'block';
            }
        }

        // é¡µé¢å¯¼èˆª
        function navigateTo(page) {
            pageHistory.push(currentPage);
            currentPage = page;
            Object.values(pageElements).forEach(view => view.classList.remove('active'));
            pageElements[page].classList.add('active');
            
            backBtn.style.display = (page !== 'home' && page !== 'lottery') ? 'block' : 'none';
            
            if (page === 'compare') {
                initStyleSelection();
            }
        }

        // äº§å“æ»‘åŠ¨åˆ‡æ¢
        function slideTo(index) {
            currentSlideIndex = index;
            detailSlider.style.transform = `translateX(-${50 * index}%)`;
            indicators.forEach((ind, i) => ind.classList.toggle('active', i === index));
            
            detailTitle.textContent = productData[index].title;
            detailSpec.innerHTML = productData[index].spec;
            
            detailAddCartBtn.style.display = index === 1 ? 'block' : 'none';
        }

        // æ»‘åŠ¨æ‰‹åŠ¿æ”¯æŒ
        document.getElementById('detailView').addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });
        
        document.getElementById('detailView').addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const diffX = touchEndX - touchStartX;
            
            if (diffX < -50 && currentSlideIndex < 1) {
                slideTo(1);
            } else if (diffX > 50 && currentSlideIndex > 0) {
                slideTo(0);
            }
        });

        // å›¾ç‰‡æ”¾å¤§åŠŸèƒ½
        function showModal(src) {
            modalImg.src = src;
            imageModal.classList.add('active');
        }

        function closeModal() {
            imageModal.classList.remove('active');
        }

        // è·³è½¬åˆ°å¯¹æ¯”é¡µ
        function goToCompareView() {
            navigateTo('compare');
        }

        // åˆå§‹åŒ–æ¬¾å¼é€‰æ‹©
        function initStyleSelection() {
            const styleOptions = document.querySelectorAll('.style-option');
            
            styleOptions.forEach(option => {
                option.classList.remove('selected');
                option.onclick = function() {
                    styleOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedProduct = this.getAttribute('data-value');
                };
            });
            selectedProduct = '';
        }

        // å¯¹æ¯”é¡µåŠ å…¥è´­ç‰©è½¦
        function compareAddToCart() {
            if (!selectedProduct) {
                alert('è¯·é€‰æ‹©ä¸€æ¬¾å……ç”µå®');
                return;
            }
            
            alert(`å……ç”µå® ${selectedProduct} å·²åŠ å…¥è´­ç‰©è½¦ï¼`);
            navigateTo('survey1');
        }

        // é—®å·é€»è¾‘
        function setupSurvey() {
            const ratingBoxes = document.querySelectorAll('.rating-box');
            const websiteRatingInput = document.getElementById('websiteRating');
            
            ratingBoxes.forEach(box => {
                box.onclick = function() {
                    const question = this.parentElement;
                    const allBoxes = question.querySelectorAll('.rating-box');
                    
                    allBoxes.forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    if (question.previousElementSibling.previousElementSibling.textContent.includes('ç½‘ç«™è®¾è®¡ä¸æœç´¢ä½“éªŒ')) {
                        websiteRatingInput.value = this.getAttribute('data-value');
                    }
                };
            });
            
            nextBtn.onclick = function() {
                const websiteRating = websiteRatingInput.value;
                const usage = document.querySelector('input[name="usage"]:checked');
                
                if (websiteRating && usage) {
                    surveyData = {
                        websiteRating: websiteRating,
                        usage: usage.value,
                        selectedProduct: selectedProduct
                    };
                    navigateTo('survey2');
                } else {
                    alert('è¯·å…ˆå®Œæˆæ‰€æœ‰é—®é¢˜');
                }
            };
        }

        // é—®å·ç¬¬äºŒé¡µæäº¤
        document.getElementById('survey2Form').onsubmit = (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            Object.assign(surveyData, {
                gender: formData.get('gender'),
                age: formData.get('age'),
                phoneLast4: formData.get('phoneLast4'),
                anonymousId: Math.random().toString(36).substr(2, 9),
                submitTime: new Date()
            });

            navigateTo('lottery');
            
            loadingContainer.style.display = 'block';
            lotteryResult.style.display = 'none';
            
            setTimeout(() => {
                loadingContainer.style.display = 'none';
                lotteryResult.style.display = 'block';
                
                const SurveyResponse = AV.Object.extend('SurveyResponses');
                new SurveyResponse().save(surveyData).then(() => {
                    console.log('é—®å·æ•°æ®ä¿å­˜æˆåŠŸ');
                }).catch(err => {
                    console.log('é—®å·ä¿å­˜å¤±è´¥ï¼š', err.message);
                });
            }, 2000);
        };

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (pageHistory.length > 0) {
                const prevPage = pageHistory.pop();
                currentPage = prevPage;
                Object.values(pageElements).forEach(view => view.classList.remove('active'));
                pageElements[prevPage].classList.add('active');
                backBtn.style.display = (prevPage !== 'home' && prevPage !== 'lottery') ? 'block' : 'none';
            }
        }

        // åˆå§‹åŒ–é—®å·
        setupSurvey();
    </script>
</body>
</html>
